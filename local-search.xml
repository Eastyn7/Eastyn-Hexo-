<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>黑马大事件后端</title>
    <link href="/2024/10/08/ev_api_server/"/>
    <url>/2024/10/08/ev_api_server/</url>
    
    <content type="html"><![CDATA[<h2 id="Headline"><a href="#Headline" class="headerlink" title="Headline"></a>Headline</h2><blockquote><p>大事件后台 API 项目，API 接口文档请参考 <a href="https://www.showdoc.cc/escook?page_id=3707158761215217">https://www.showdoc.cc/escook?page_id&#x3D;3707158761215217</a></p></blockquote><h2 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1. 初始化"></a>1. 初始化</h2><h3 id="1-1-创建项目"><a href="#1-1-创建项目" class="headerlink" title="1.1 创建项目"></a>1.1 创建项目</h3><ol><li>新建 <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm init -y<br></code></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装特定版本的 <code>express</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i express@4.17.1<br></code></pre></td></tr></table></figure><ol start="3"><li>在项目根目录中新建 <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 express 模块</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建 express 的服务器实例</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br><span class="hljs-comment">// write your code here...</span><br><br><span class="hljs-comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3007</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;api server running at http://127.0.0.1:3007&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="1-2-配置-cors-跨域"><a href="#1-2-配置-cors-跨域" class="headerlink" title="1.2 配置 cors 跨域"></a>1.2 配置 cors 跨域</h3><ol><li>运行如下的命令，安装 <code>cors</code> 中间件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i cors@2.8.5<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并配置 <code>cors</code> 中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 cors 中间件</span><br><span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>)<br><span class="hljs-comment">// 将 cors 注册为全局中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())<br></code></pre></td></tr></table></figure><h3 id="1-3-配置解析表单数据的中间件"><a href="#1-3-配置解析表单数据的中间件" class="headerlink" title="1.3 配置解析表单数据的中间件"></a>1.3 配置解析表单数据的中间件</h3><ol><li>通过如下的代码，配置解析 <code>application/x-www-form-urlencoded</code> 格式的表单数据的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;))<br></code></pre></td></tr></table></figure><h3 id="1-4-初始化路由相关的文件夹"><a href="#1-4-初始化路由相关的文件夹" class="headerlink" title="1.4 初始化路由相关的文件夹"></a>1.4 初始化路由相关的文件夹</h3><ol><li><p>在项目根目录中，新建 <code>router</code> 文件夹，用来存放所有的<code>路由</code>模块</p><blockquote><p>路由模块中，只存放客户端的请求与处理函数之间的映射关系</p></blockquote></li><li><p>在项目根目录中，新建 <code>router_handler</code> 文件夹，用来存放所有的 <code>路由处理函数模块</code></p><blockquote><p>路由处理函数模块中，专门负责存放每个路由对应的处理函数</p></blockquote></li></ol><h3 id="1-5-初始化用户路由模块"><a href="#1-5-初始化用户路由模块" class="headerlink" title="1.5 初始化用户路由模块"></a>1.5 初始化用户路由模块</h3><ol><li>在 <code>router</code> 文件夹中，新建 <code>user.js</code> 文件，作为用户的路由模块，并初始化代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建路由对象</span><br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 注册新用户</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/reguser&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;reguser OK&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 登录</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;login OK&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 将路由对象共享出去</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中，导入并使用 <code>用户路由模块</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入并注册用户路由模块</span><br><span class="hljs-keyword">const</span> userRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./router/user&#x27;</span>)<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api&#x27;</span>, userRouter)<br></code></pre></td></tr></table></figure><h3 id="1-6-抽离用户路由模块中的处理函数"><a href="#1-6-抽离用户路由模块中的处理函数" class="headerlink" title="1.6 抽离用户路由模块中的处理函数"></a>1.6 抽离用户路由模块中的处理函数</h3><blockquote><p>目的：为了保证 <code>路由模块</code> 的纯粹性，所有的 <code>路由处理函数</code>，必须抽离到对应的 <code>路由处理函数模块</code> 中</p></blockquote><ol><li>在 <code>/router_handler/user.js</code> 中，使用 <code>exports</code> 对象，分别向外共享如下两个 <code>路由处理函数</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 在这里定义和用户相关的路由处理函数，供 /router/user.js 模块进行调用</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// 注册用户的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">regUser</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;reguser OK&#x27;</span>)<br>&#125;<br><br><span class="hljs-comment">// 登录的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">login</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;login OK&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>将 <code>/router/user.js</code> 中的代码修改为如下结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 导入用户路由处理函数模块</span><br><span class="hljs-keyword">const</span> userHandler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../router_handler/user&#x27;</span>)<br><br><span class="hljs-comment">// 注册新用户</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/reguser&#x27;</span>, userHandler.<span class="hljs-property">regUser</span>)<br><span class="hljs-comment">// 登录</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, userHandler.<span class="hljs-property">login</span>)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><h2 id="2-登录注册"><a href="#2-登录注册" class="headerlink" title="2. 登录注册"></a>2. 登录注册</h2><h3 id="2-1-新建-ev-users-表"><a href="#2-1-新建-ev-users-表" class="headerlink" title="2.1 新建 ev_users 表"></a>2.1 新建 ev_users 表</h3><ol><li>在 <code>my_db_01</code> 数据库中，新建 <code>ev_users</code> 表如下：<br><img src="/./images/1.jpg" alt="ev_users表结构"></li></ol><h3 id="2-2-安装并配置-mysql-模块"><a href="#2-2-安装并配置-mysql-模块" class="headerlink" title="2.2 安装并配置 mysql 模块"></a>2.2 安装并配置 mysql 模块</h3><blockquote><p>在 API 接口项目中，需要安装并配置 <code>mysql</code> 这个第三方模块，来连接和操作 MySQL 数据库</p></blockquote><ol><li>运行如下命令，安装 <code>mysql</code> 模块：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i mysql@2.18.1<br></code></pre></td></tr></table></figure><ol start="2"><li>在项目根目录中新建 <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 mysql 模块</span><br><span class="hljs-keyword">const</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mysql&#x27;</span>)<br><br><span class="hljs-comment">// 创建数据库连接对象</span><br><span class="hljs-keyword">const</span> db = mysql.<span class="hljs-title function_">createPool</span>(&#123;<br>  <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>  <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;admin123&#x27;</span>,<br>  <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;my_db_01&#x27;</span>,<br>&#125;)<br><br><span class="hljs-comment">// 向外共享 db 数据库连接对象</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = db<br></code></pre></td></tr></table></figure><h3 id="2-3-注册"><a href="#2-3-注册" class="headerlink" title="2.3 注册"></a>2.3 注册</h3><h4 id="2-3-0-实现步骤"><a href="#2-3-0-实现步骤" class="headerlink" title="2.3.0 实现步骤"></a>2.3.0 实现步骤</h4><ol><li>检测表单数据是否合法</li><li>检测用户名是否被占用</li><li>对密码进行加密处理</li><li>插入新用户</li></ol><h4 id="2-3-1-检测表单数据是否合法"><a href="#2-3-1-检测表单数据是否合法" class="headerlink" title="2.3.1 检测表单数据是否合法"></a>2.3.1 检测表单数据是否合法</h4><ol><li>判断用户名和密码是否为空</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 接收表单数据</span><br><span class="hljs-keyword">const</span> userinfo = req.<span class="hljs-property">body</span><br><span class="hljs-comment">// 判断数据是否合法</span><br><span class="hljs-keyword">if</span> (!userinfo.<span class="hljs-property">username</span> || !userinfo.<span class="hljs-property">password</span>) &#123;<br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;用户名或密码不能为空！&#x27;</span> &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-3-2-检测用户名是否被占用"><a href="#2-3-2-检测用户名是否被占用" class="headerlink" title="2.3.2 检测用户名是否被占用"></a>2.3.2 检测用户名是否被占用</h4><ol><li>导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../db/index&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_users where username=?`</span><br></code></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句并根据结果判断用户名是否被占用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, [userinfo.<span class="hljs-property">username</span>], <span class="hljs-keyword">function</span> (<span class="hljs-params">err, results</span>) &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> &#125;)<br>  &#125;<br>  <span class="hljs-comment">// 用户名被占用</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;用户名被占用，请更换其他用户名！&#x27;</span> &#125;)<br>  &#125;<br>  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 用户名可用，继续后续流程...</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="2-3-3-对密码进行加密处理"><a href="#2-3-3-对密码进行加密处理" class="headerlink" title="2.3.3 对密码进行加密处理"></a>2.3.3 对密码进行加密处理</h4><blockquote><p>为了保证密码的安全性，不建议在数据库以 <code>明文</code> 的形式保存用户密码，推荐对密码进行 <code>加密存储</code></p></blockquote><hr><p>在当前项目中，使用 <code>bcryptjs</code> 对用户密码进行加密，优点：</p><ul><li>加密之后的密码，<strong>无法被逆向破解</strong></li><li>同一明文密码多次加密，得到的<strong>加密结果各不相同</strong>，保证了安全性</li></ul><hr><ol><li>运行如下命令，安装指定版本的 <code>bcryptjs</code> ：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i bcryptjs@2.4.3<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/user.js</code> 中，导入 <code>bcryptjs</code> ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bcryptjs&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="3"><li>在注册用户的处理函数中，确认用户名可用之后，调用 <code>bcrypt.hashSync(明文密码, 随机盐的长度)</code> 方法，对用户的密码进行加密处理：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 对用户的密码,进行 bcrype 加密，返回值是加密之后的密码字符串</span><br>userinfo.<span class="hljs-property">password</span> = bcrypt.<span class="hljs-title function_">hashSync</span>(userinfo.<span class="hljs-property">password</span>, <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h4 id="2-3-4-插入新用户"><a href="#2-3-4-插入新用户" class="headerlink" title="2.3.4 插入新用户"></a>2.3.4 插入新用户</h4><ol><li>定义插入用户的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">&#x27;insert into ev_users set ?&#x27;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，插入新用户：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, &#123; <span class="hljs-attr">username</span>: userinfo.<span class="hljs-property">username</span>, <span class="hljs-attr">password</span>: userinfo.<span class="hljs-property">password</span> &#125;, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, results</span>) &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> &#125;)<br>  <span class="hljs-comment">// SQL 语句执行成功，但影响行数不为 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;注册用户失败，请稍后再试！&#x27;</span> &#125;)<br>  &#125;<br>  <span class="hljs-comment">// 注册成功</span><br>  res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;注册成功！&#x27;</span> &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-4-优化-res-send-代码"><a href="#2-4-优化-res-send-代码" class="headerlink" title="2.4 优化 res.send() 代码"></a>2.4 优化 res.send() 代码</h3><blockquote><p>在处理函数中，需要多次调用 <code>res.send()</code> 向客户端响应 <code>处理失败</code> 的结果，为了简化代码，可以手动封装一个 res.cc() 函数</p></blockquote><ol><li>在 <code>app.js</code> 中，所有路由之前，声明一个全局中间件，为 res 对象挂载一个 <code>res.cc()</code> 函数 ：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 响应数据的中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// status = 0 为成功； status = 1 为失败； 默认将 status 的值设置为 1，方便处理失败的情况</span><br>  res.<span class="hljs-property">cc</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">err, status = <span class="hljs-number">1</span></span>) &#123;<br>    res.<span class="hljs-title function_">send</span>(&#123;<br>      <span class="hljs-comment">// 状态</span><br>      status,<br>      <span class="hljs-comment">// 状态描述，判断 err 是 错误对象 还是 字符串</span><br>      <span class="hljs-attr">message</span>: err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? err.<span class="hljs-property">message</span> : err,<br>    &#125;)<br>  &#125;<br>  <span class="hljs-title function_">next</span>()<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-5-优化表单数据验证"><a href="#2-5-优化表单数据验证" class="headerlink" title="2.5 优化表单数据验证"></a>2.5 优化表单数据验证</h3><blockquote><p>表单验证的原则：前端验证为辅，后端验证为主，后端<strong>永远不要相信</strong>前端提交过来的<strong>任何内容</strong></p></blockquote><p>在实际开发中，前后端都需要对表单的数据进行合法性的验证，而且，<strong>后端做为数据合法性验证的最后一个关口</strong>，在拦截非法数据方面，起到了至关重要的作用。</p><p>单纯的使用 <code>if...else...</code> 的形式对数据合法性进行验证，效率低下、出错率高、维护性差。因此，推荐使用<strong>第三方数据验证模块</strong>，来降低出错率、提高验证的效率与可维护性，<strong>让后端程序员把更多的精力放在核心业务逻辑的处理上</strong>。</p><ol><li>安装 <code>@hapi/joi</code> 包，为表单中携带的每个数据项，定义验证规则：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @hapi/joi@17.1.0<br></code></pre></td></tr></table></figure><ol start="2"><li>安装 <code>@escook/express-joi</code> 中间件，来实现自动对表单数据进行验证的功能：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i @escook/express-joi<br></code></pre></td></tr></table></figure><ol start="3"><li>新建 <code>/schema/user.js</code> 用户信息验证规则模块，并初始化代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@hapi/joi&#x27;</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * string() 值必须是字符串</span><br><span class="hljs-comment"> * alphanum() 值只能是包含 a-zA-Z0-9 的字符串</span><br><span class="hljs-comment"> * min(length) 最小长度</span><br><span class="hljs-comment"> * max(length) 最大长度</span><br><span class="hljs-comment"> * required() 值是必填项，不能为 undefined</span><br><span class="hljs-comment"> * pattern(正则表达式) 值必须符合正则表达式的规则</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// 用户名的验证规则</span><br><span class="hljs-keyword">const</span> username = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">alphanum</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">required</span>()<br><span class="hljs-comment">// 密码的验证规则</span><br><span class="hljs-keyword">const</span> password = joi<br>  .<span class="hljs-title function_">string</span>()<br>  .<span class="hljs-title function_">pattern</span>(<span class="hljs-regexp">/^[\S]&#123;6,12&#125;$/</span>)<br>  .<span class="hljs-title function_">required</span>()<br><br><span class="hljs-comment">// 注册和登录表单的验证规则对象</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">reg_login_schema</span> = &#123;<br>  <span class="hljs-comment">// 表示需要对 req.body 中的数据进行验证</span><br>  <span class="hljs-attr">body</span>: &#123;<br>    username,<br>    password,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>修改 <code>/router/user.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 导入用户路由处理函数模块</span><br><span class="hljs-keyword">const</span> userHandler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../router_handler/user&#x27;</span>)<br><br><span class="hljs-comment">// 1. 导入验证表单数据的中间件</span><br><span class="hljs-keyword">const</span> expressJoi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@escook/express-joi&#x27;</span>)<br><span class="hljs-comment">// 2. 导入需要的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; reg_login_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/user&#x27;</span>)<br><br><span class="hljs-comment">// 注册新用户</span><br><span class="hljs-comment">// 3. 在注册新用户的路由中，声明局部中间件，对当前请求中携带的数据进行验证</span><br><span class="hljs-comment">// 3.1 数据验证通过后，会把这次请求流转给后面的路由处理函数</span><br><span class="hljs-comment">// 3.2 数据验证失败后，终止后续代码的执行，并抛出一个全局的 Error 错误，进入全局错误级别中间件中进行处理</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/reguser&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(reg_login_schema), userHandler.<span class="hljs-property">regUser</span>)<br><span class="hljs-comment">// 登录</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, userHandler.<span class="hljs-property">login</span>)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><ol start="5"><li>在 <code>app.js</code> 的全局错误级别中间件中，捕获验证失败的错误，并把验证失败的结果响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@hapi/joi&#x27;</span>)<br><br><span class="hljs-comment">// 错误中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-comment">// 数据验证失败</span><br>  <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> joi.<span class="hljs-property">ValidationError</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br>  <span class="hljs-comment">// 未知错误</span><br>  res.<span class="hljs-title function_">cc</span>(err)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-6-登录"><a href="#2-6-登录" class="headerlink" title="2.6 登录"></a>2.6 登录</h3><h4 id="2-6-0-实现步骤"><a href="#2-6-0-实现步骤" class="headerlink" title="2.6.0 实现步骤"></a>2.6.0 实现步骤</h4><ol><li>检测表单数据是否合法</li><li>根据用户名查询用户的数据</li><li>判断用户输入的密码是否正确</li><li>生成 JWT 的 Token 字符串</li></ol><h4 id="2-6-1-检测登录表单的数据是否合法"><a href="#2-6-1-检测登录表单的数据是否合法" class="headerlink" title="2.6.1 检测登录表单的数据是否合法"></a>2.6.1 检测登录表单的数据是否合法</h4><ol><li>将 <code>/router/user.js</code> 中 <code>登录</code> 的路由代码修改如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 登录的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(reg_login_schema), userHandler.<span class="hljs-property">login</span>)<br></code></pre></td></tr></table></figure><h4 id="2-6-2-根据用户名查询用户的数据"><a href="#2-6-2-根据用户名查询用户的数据" class="headerlink" title="2.6.2 根据用户名查询用户的数据"></a>2.6.2 根据用户名查询用户的数据</h4><ol><li>接收表单数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> userinfo = req.<span class="hljs-property">body</span><br></code></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_users where username=?`</span><br></code></pre></td></tr></table></figure><ol start="3"><li>执行 SQL 语句，查询用户的数据：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, userinfo.<span class="hljs-property">username</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, results</span>) &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br>  <span class="hljs-comment">// 执行 SQL 语句成功，但是查询到数据条数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;登录失败！&#x27;</span>)<br>  <span class="hljs-comment">// TODO：判断用户输入的登录密码是否和数据库中的密码一致</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="2-6-3-判断用户输入的密码是否正确"><a href="#2-6-3-判断用户输入的密码是否正确" class="headerlink" title="2.6.3 判断用户输入的密码是否正确"></a>2.6.3 判断用户输入的密码是否正确</h4><blockquote><p>核心实现思路：调用 <code>bcrypt.compareSync(用户提交的密码, 数据库中的密码)</code> 方法比较密码是否一致</p></blockquote><blockquote><p>返回值是布尔值（true 一致、false 不一致）</p></blockquote><p>具体的实现代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 拿着用户输入的密码,和数据库中存储的密码进行对比</span><br><span class="hljs-keyword">const</span> compareResult = bcrypt.<span class="hljs-title function_">compareSync</span>(userinfo.<span class="hljs-property">password</span>, results[<span class="hljs-number">0</span>].<span class="hljs-property">password</span>)<br><br><span class="hljs-comment">// 如果对比的结果等于 false, 则证明用户输入的密码错误</span><br><span class="hljs-keyword">if</span> (!compareResult) &#123;<br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;登录失败！&#x27;</span>)<br>&#125;<br><br><span class="hljs-comment">// TODO：登录成功，生成 Token 字符串</span><br></code></pre></td></tr></table></figure><h4 id="2-6-4-生成-JWT-的-Token-字符串"><a href="#2-6-4-生成-JWT-的-Token-字符串" class="headerlink" title="2.6.4 生成 JWT 的 Token 字符串"></a>2.6.4 生成 JWT 的 Token 字符串</h4><blockquote><p>核心注意点：在生成 Token 字符串的时候，一定要剔除 <strong>密码</strong> 和 <strong>头像</strong> 的值</p></blockquote><ol><li>通过 ES6 的高级语法，快速剔除 <code>密码</code> 和 <code>头像</code> 的值：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 剔除完毕之后，user 中只保留了用户的 id, username, nickname, email 这四个属性的值</span><br><span class="hljs-keyword">const</span> user = &#123; ...results[<span class="hljs-number">0</span>], <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">user_pic</span>: <span class="hljs-string">&#x27;&#x27;</span> &#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>运行如下的命令，安装生成 Token 字符串的包：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i jsonwebtoken@8.5.1<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/user.js</code> 模块的头部区域，导入 <code>jsonwebtoken</code> 包：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 用这个包来生成 Token 字符串</span><br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="4"><li>创建 <code>config.js</code> 文件，并向外共享 <strong>加密</strong> 和 <strong>还原</strong> Token 的 <code>jwtSecretKey</code> 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">jwtSecretKey</span>: <span class="hljs-string">&#x27;itheima No1. ^_^&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>将用户信息对象加密成 Token 字符串：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入配置文件</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config&#x27;</span>)<br><br><span class="hljs-comment">// 生成 Token 字符串</span><br><span class="hljs-keyword">const</span> tokenStr = jwt.<span class="hljs-title function_">sign</span>(user, config.<span class="hljs-property">jwtSecretKey</span>, &#123;<br>  <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">&#x27;10h&#x27;</span>, <span class="hljs-comment">// token 有效期为 10 个小时</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="6"><li>将生成的 Token 字符串响应给客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">res.<span class="hljs-title function_">send</span>(&#123;<br>  <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;登录成功！&#x27;</span>,<br>  <span class="hljs-comment">// 为了方便客户端使用 Token，在服务器端直接拼接上 Bearer 的前缀</span><br>  <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;Bearer &#x27;</span> + tokenStr,<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-7-配置解析-Token-的中间件"><a href="#2-7-配置解析-Token-的中间件" class="headerlink" title="2.7 配置解析 Token 的中间件"></a>2.7 配置解析 Token 的中间件</h3><ol><li>运行如下的命令，安装解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npm i express-jwt@<span class="hljs-number">5.3</span><span class="hljs-number">.3</span><br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中注册路由之前，配置解析 Token 的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入配置文件</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./config&#x27;</span>)<br><br><span class="hljs-comment">// 解析 token 的中间件</span><br><span class="hljs-keyword">const</span> expressJWT = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-jwt&#x27;</span>)<br><br><span class="hljs-comment">// 使用 .unless(&#123; path: [/^\/api\//] &#125;) 指定哪些接口不需要进行 Token 的身份认证</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">expressJWT</span>(&#123; <span class="hljs-attr">secret</span>: config.<span class="hljs-property">jwtSecretKey</span> &#125;).<span class="hljs-title function_">unless</span>(&#123; <span class="hljs-attr">path</span>: [<span class="hljs-regexp">/^\/api\//</span>] &#125;))<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>app.js</code> 中的 <code>错误级别中间件</code> 里面，捕获并处理 Token 认证失败后的错误：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 错误中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-comment">// 省略其它代码...</span><br><br>  <span class="hljs-comment">// 捕获身份认证失败的错误</span><br>  <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;UnauthorizedError&#x27;</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;身份认证失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 未知错误...</span><br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="3-个人中心"><a href="#3-个人中心" class="headerlink" title="3. 个人中心"></a>3. 个人中心</h2><h3 id="3-1-获取用户的基本信息"><a href="#3-1-获取用户的基本信息" class="headerlink" title="3.1 获取用户的基本信息"></a>3.1 获取用户的基本信息</h3><h4 id="3-1-0-实现步骤"><a href="#3-1-0-实现步骤" class="headerlink" title="3.1.0 实现步骤"></a>3.1.0 实现步骤</h4><ol><li>初始化 <strong>路由</strong> 模块</li><li>初始化 <strong>路由处理函数</strong> 模块</li><li>获取用户的基本信息</li></ol><h4 id="3-1-1-初始化路由模块"><a href="#3-1-1-初始化路由模块" class="headerlink" title="3.1.1 初始化路由模块"></a>3.1.1 初始化路由模块</h4><ol><li>创建 <code>/router/userinfo.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 express</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建路由对象</span><br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 获取用户的基本信息</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/userinfo&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 向外共享路由对象</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用个人中心的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入并使用用户信息路由模块</span><br><span class="hljs-keyword">const</span> userinfoRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./router/userinfo&#x27;</span>)<br><span class="hljs-comment">// 注意：以 /my 开头的接口，都是有权限的接口，需要进行 Token 身份认证</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/my&#x27;</span>, userinfoRouter)<br></code></pre></td></tr></table></figure><h4 id="3-1-2-初始化路由处理函数模块"><a href="#3-1-2-初始化路由处理函数模块" class="headerlink" title="3.1.2 初始化路由处理函数模块"></a>3.1.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/userinfo.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 获取用户基本信息的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">getUserInfo</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/userinfo.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 导入用户信息的处理函数模块</span><br><span class="hljs-keyword">const</span> userinfo_handler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../router_handler/userinfo&#x27;</span>)<br><br><span class="hljs-comment">// 获取用户的基本信息</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/userinfo&#x27;</span>, userinfo_handler.<span class="hljs-property">getUserInfo</span>)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><h4 id="3-1-3-获取用户的基本信息"><a href="#3-1-3-获取用户的基本信息" class="headerlink" title="3.1.3 获取用户的基本信息"></a>3.1.3 获取用户的基本信息</h4><ol><li>在 <code>/router_handler/userinfo.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入数据库操作模块</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../db/index&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 根据用户的 id，查询用户的基本信息</span><br><span class="hljs-comment">// 注意：为了防止用户的密码泄露，需要排除 password 字段</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select id, username, nickname, email, user_pic from ev_users where id=?`</span><br></code></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 注意：req 对象上的 user 属性，是 Token 解析成功，express-jwt 中间件帮我们挂载上去的</span><br>db.<span class="hljs-title function_">query</span>(sql, req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 1. 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 2. 执行 SQL 语句成功，但是查询到的数据条数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;获取用户信息失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 3. 将用户信息响应给客户端</span><br>  res.<span class="hljs-title function_">send</span>(&#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;获取用户基本信息成功！&#x27;</span>,<br>    <span class="hljs-attr">data</span>: results[<span class="hljs-number">0</span>],<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="3-2-更新用户的基本信息"><a href="#3-2-更新用户的基本信息" class="headerlink" title="3.2 更新用户的基本信息"></a>3.2 更新用户的基本信息</h3><h4 id="3-2-0-实现步骤"><a href="#3-2-0-实现步骤" class="headerlink" title="3.2.0 实现步骤"></a>3.2.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户基本信息的功能</li></ol><h4 id="3-2-1-定义路由和处理函数"><a href="#3-2-1-定义路由和处理函数" class="headerlink" title="3.2.1 定义路由和处理函数"></a>3.2.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户基本信息</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新用户的基本信息</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/userinfo&#x27;</span>, userinfo_handler.<span class="hljs-property">updateUserInfo</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户基本信息</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新用户基本信息的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">updateUserInfo</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-2-2-验证表单数据"><a href="#3-2-2-验证表单数据" class="headerlink" title="3.2.2 验证表单数据"></a>3.2.2 验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>id</code>，<code>nickname</code>，<code>email</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义 id, nickname, emial 的验证规则</span><br><span class="hljs-keyword">const</span> id = joi.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">integer</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">required</span>()<br><span class="hljs-keyword">const</span> nickname = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>()<br><span class="hljs-keyword">const</span> email = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">email</span>().<span class="hljs-title function_">required</span>()<br></code></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 验证规则对象 - 更新用户基本信息</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">update_userinfo_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    id,<br>    nickname,<br>    email,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入验证数据合法性的中间件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入验证数据合法性的中间件</span><br><span class="hljs-keyword">const</span> expressJoi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@escook/express-joi&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入需要的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; update_userinfo_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/user&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="5"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户的基本信息</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新用户的基本信息</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/userinfo&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(update_userinfo_schema), userinfo_handler.<span class="hljs-property">updateUserInfo</span>)<br></code></pre></td></tr></table></figure><h4 id="3-2-3-实现更新用户基本信息的功能"><a href="#3-2-3-实现更新用户基本信息的功能" class="headerlink" title="3.2.3 实现更新用户基本信息的功能"></a>3.2.3 实现更新用户基本信息的功能</h4><ol><li>定义待执行的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`update ev_users set ? where id=?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句并传参：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, [req.<span class="hljs-property">body</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">id</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 执行 SQL 语句成功，但影响行数不为 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;修改用户基本信息失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 修改用户信息成功</span><br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;修改用户基本信息成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="3-3-重置密码"><a href="#3-3-重置密码" class="headerlink" title="3.3 重置密码"></a>3.3 重置密码</h3><h4 id="3-3-0-实现步骤"><a href="#3-3-0-实现步骤" class="headerlink" title="3.3.0 实现步骤"></a>3.3.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现重置密码的功能</li></ol><h4 id="3-3-1-定义路由和处理函数"><a href="#3-3-1-定义路由和处理函数" class="headerlink" title="3.3.1 定义路由和处理函数"></a>3.3.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>重置密码</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 重置密码的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/updatepwd&#x27;</span>, userinfo_handler.<span class="hljs-property">updatePassword</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>重置密码</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 重置密码的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">updatePassword</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-3-2-验证表单数据"><a href="#3-3-2-验证表单数据" class="headerlink" title="3.3.2 验证表单数据"></a>3.3.2 验证表单数据</h4><blockquote><p>核心验证思路：旧密码与新密码，必须符合密码的验证规则，并且新密码不能与旧密码一致！</p></blockquote><ol><li>在 <code>/schema/user.js</code> 模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 验证规则对象 - 重置密码</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">update_password_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    <span class="hljs-comment">// 使用 password 这个规则，验证 req.body.oldPwd 的值</span><br>    <span class="hljs-attr">oldPwd</span>: password,<br>    <span class="hljs-comment">// 使用 joi.not(joi.ref(&#x27;oldPwd&#x27;)).concat(password) 规则，验证 req.body.newPwd 的值</span><br>    <span class="hljs-comment">// 解读：</span><br>    <span class="hljs-comment">// 1. joi.ref(&#x27;oldPwd&#x27;) 表示 newPwd 的值必须和 oldPwd 的值保持一致</span><br>    <span class="hljs-comment">// 2. joi.not(joi.ref(&#x27;oldPwd&#x27;)) 表示 newPwd 的值不能等于 oldPwd 的值</span><br>    <span class="hljs-comment">// 3. .concat() 用于合并 joi.not(joi.ref(&#x27;oldPwd&#x27;)) 和 password 这两条验证规则</span><br>    <span class="hljs-attr">newPwd</span>: joi.<span class="hljs-title function_">not</span>(joi.<span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;oldPwd&#x27;</span>)).<span class="hljs-title function_">concat</span>(password),<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入需要的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; update_userinfo_schema, update_password_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/user&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="3"><li>并在 <code>重置密码的路由</code> 中，使用 <code>update_password_schema</code> 规则验证表单的数据，示例代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/updatepwd&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(update_password_schema), userinfo_handler.<span class="hljs-property">updatePassword</span>)<br></code></pre></td></tr></table></figure><h4 id="3-3-3-实现重置密码的功能"><a href="#3-3-3-实现重置密码的功能" class="headerlink" title="3.3.3 实现重置密码的功能"></a>3.3.3 实现重置密码的功能</h4><ol><li>根据 <code>id</code> 查询用户是否存在：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义根据 id 查询用户数据的 SQL 语句</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_users where id=?`</span><br><br><span class="hljs-comment">// 执行 SQL 语句查询用户是否存在</span><br>db.<span class="hljs-title function_">query</span>(sql, req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 检查指定 id 的用户是否存在</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;用户不存在！&#x27;</span>)<br><br>  <span class="hljs-comment">// TODO：判断提交的旧密码是否正确</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="2"><li>判断提交的 <strong>旧密码</strong> 是否正确：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 在头部区域导入 bcryptjs 后，</span><br><span class="hljs-comment">// 即可使用 bcrypt.compareSync(提交的密码，数据库中的密码) 方法验证密码是否正确</span><br><span class="hljs-comment">// compareSync() 函数的返回值为布尔值，true 表示密码正确，false 表示密码错误</span><br><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bcryptjs&#x27;</span>)<br><br><span class="hljs-comment">// 判断提交的旧密码是否正确</span><br><span class="hljs-keyword">const</span> compareResult = bcrypt.<span class="hljs-title function_">compareSync</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">oldPwd</span>, results[<span class="hljs-number">0</span>].<span class="hljs-property">password</span>)<br><span class="hljs-keyword">if</span> (!compareResult) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;原密码错误！&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="3"><li>对新密码进行 <code>bcrypt</code> 加密之后，更新到数据库中：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义更新用户密码的 SQL 语句</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`update ev_users set password=? where id=?`</span><br><br><span class="hljs-comment">// 对新密码进行 bcrypt 加密处理</span><br><span class="hljs-keyword">const</span> newPwd = bcrypt.<span class="hljs-title function_">hashSync</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">newPwd</span>, <span class="hljs-number">10</span>)<br><br><span class="hljs-comment">// 执行 SQL 语句，根据 id 更新用户的密码</span><br>db.<span class="hljs-title function_">query</span>(sql, [newPwd, req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// SQL 语句执行失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// SQL 语句执行成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新密码失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 更新密码成功</span><br>  res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新密码成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="3-4-更新用户头像"><a href="#3-4-更新用户头像" class="headerlink" title="3.4 更新用户头像"></a>3.4 更新用户头像</h3><h4 id="3-4-0-实现步骤"><a href="#3-4-0-实现步骤" class="headerlink" title="3.4.0 实现步骤"></a>3.4.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现更新用户头像的功能</li></ol><h4 id="3-4-1-定义路由和处理函数"><a href="#3-4-1-定义路由和处理函数" class="headerlink" title="3.4.1 定义路由和处理函数"></a>3.4.1 定义路由和处理函数</h4><ol><li>在 <code>/router/userinfo.js</code> 模块中，新增 <code>更新用户头像</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新用户头像的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/update/avatar&#x27;</span>, userinfo_handler.<span class="hljs-property">updateAvatar</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/userinfo.js</code> 模块中，定义并向外共享 <code>更新用户头像</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新用户头像的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">updateAvatar</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-4-2-验证表单数据"><a href="#3-4-2-验证表单数据" class="headerlink" title="3.4.2 验证表单数据"></a>3.4.2 验证表单数据</h4><ol><li>在 <code>/schema/user.js</code> 验证规则模块中，定义 <code>avatar</code> 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// dataUri() 指的是如下格式的字符串数据：</span><br><span class="hljs-comment">// data:image/png;base64,VE9PTUFOWVNFQ1JFVFM=</span><br><span class="hljs-keyword">const</span> avatar = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">dataUri</span>().<span class="hljs-title function_">required</span>()<br></code></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 验证规则对象 - 更新头像</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">update_avatar_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    avatar,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/userinfo.js</code> 模块中，导入需要的验证规则对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; update_avatar_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/user&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router/userinfo.js</code> 模块中，修改 <code>更新用户头像</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/update/avatar&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(update_avatar_schema), userinfo_handler.<span class="hljs-property">updateAvatar</span>)<br></code></pre></td></tr></table></figure><h4 id="3-4-3-实现更新用户头像的功能"><a href="#3-4-3-实现更新用户头像的功能" class="headerlink" title="3.4.3 实现更新用户头像的功能"></a>3.4.3 实现更新用户头像的功能</h4><ol><li>定义更新用户头像的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">&#x27;update ev_users set user_pic=? where id=?&#x27;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句，更新对应用户的头像：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, [req.<span class="hljs-property">body</span>.<span class="hljs-property">avatar</span>, req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新头像失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 更新用户头像成功</span><br>  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新头像成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="4-文章分类管理"><a href="#4-文章分类管理" class="headerlink" title="4. 文章分类管理"></a>4. 文章分类管理</h2><h3 id="4-1-新建-ev-article-cate-表"><a href="#4-1-新建-ev-article-cate-表" class="headerlink" title="4.1 新建 ev_article_cate 表"></a>4.1 新建 ev_article_cate 表</h3><h4 id="4-1-1-创建表结构"><a href="#4-1-1-创建表结构" class="headerlink" title="4.1.1 创建表结构"></a>4.1.1 创建表结构</h4><p><img src="/./images/2.jpg" alt="文章分类表结构"></p><h4 id="4-1-2-新增两条初始数据"><a href="#4-1-2-新增两条初始数据" class="headerlink" title="4.1.2 新增两条初始数据"></a>4.1.2 新增两条初始数据</h4><p><img src="/./images/3.jpg" alt="文章分类表结构"></p><h3 id="4-2-获取文章分类列表"><a href="#4-2-获取文章分类列表" class="headerlink" title="4.2 获取文章分类列表"></a>4.2 获取文章分类列表</h3><h4 id="4-2-0-实现步骤"><a href="#4-2-0-实现步骤" class="headerlink" title="4.2.0 实现步骤"></a>4.2.0 实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>获取文章分类列表数据</li></ol><h4 id="4-2-1-初始化路由模块"><a href="#4-2-1-初始化路由模块" class="headerlink" title="4.2.1 初始化路由模块"></a>4.2.1 初始化路由模块</h4><ol><li>创建 <code>/router/artcate.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 express</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建路由对象</span><br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 获取文章分类的列表数据</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/cates&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 向外共享路由对象</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章分类的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入并使用文章分类路由模块</span><br><span class="hljs-keyword">const</span> artCateRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./router/artcate&#x27;</span>)<br><span class="hljs-comment">// 为文章分类的路由挂载统一的访问前缀 /my/article</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/my/article&#x27;</span>, artCateRouter)<br></code></pre></td></tr></table></figure><h4 id="4-2-2-初始化路由处理函数模块"><a href="#4-2-2-初始化路由处理函数模块" class="headerlink" title="4.2.2 初始化路由处理函数模块"></a>4.2.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/artcate.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 获取文章分类列表数据的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">getArticleCates</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/artcate.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 导入文章分类的路由处理函数模块</span><br><span class="hljs-keyword">const</span> artcate_handler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../router_handler/artcate&#x27;</span>)<br><br><span class="hljs-comment">// 获取文章分类的列表数据</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/cates&#x27;</span>, artcate_handler.<span class="hljs-property">getArticleCates</span>)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><h4 id="4-2-3-获取文章分类列表数据"><a href="#4-2-3-获取文章分类列表数据" class="headerlink" title="4.2.3 获取文章分类列表数据"></a>4.2.3 获取文章分类列表数据</h4><ol><li>在 <code>/router_handler/artcate.js</code> 头部导入数据库操作模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入数据库操作模块</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../db/index&#x27;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>定义 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 根据分类的状态，获取所有未被删除的分类列表数据</span><br><span class="hljs-comment">// is_delete 为 0 表示没有被 标记为删除 的数据</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">&#x27;select * from ev_article_cate where is_delete=0 order by id asc&#x27;</span><br></code></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 1. 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 2. 执行 SQL 语句成功</span><br>  res.<span class="hljs-title function_">send</span>(&#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;获取文章分类列表成功！&#x27;</span>,<br>    <span class="hljs-attr">data</span>: results,<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="4-3-新增文章分类"><a href="#4-3-新增文章分类" class="headerlink" title="4.3 新增文章分类"></a>4.3 新增文章分类</h3><h4 id="4-3-0-实现步骤"><a href="#4-3-0-实现步骤" class="headerlink" title="4.3.0 实现步骤"></a>4.3.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现新增文章分类的功能</li></ol><h4 id="4-3-1-定义路由和处理函数"><a href="#4-3-1-定义路由和处理函数" class="headerlink" title="4.3.1 定义路由和处理函数"></a>4.3.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>新增文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 新增文章分类的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/addcates&#x27;</span>, artcate_handler.<span class="hljs-property">addArticleCates</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>新增文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 新增文章分类的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">addArticleCates</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-3-2-验证表单数据"><a href="#4-3-2-验证表单数据" class="headerlink" title="4.3.2 验证表单数据"></a>4.3.2 验证表单数据</h4><ol><li>创建 <code>/schema/artcate.js</code> 文章分类数据验证模块，并定义如下的验证规则：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入定义验证规则的模块</span><br><span class="hljs-keyword">const</span> joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@hapi/joi&#x27;</span>)<br><br><span class="hljs-comment">// 定义 分类名称 和 分类别名 的校验规则</span><br><span class="hljs-keyword">const</span> name = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>()<br><span class="hljs-keyword">const</span> alias = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">alphanum</span>().<span class="hljs-title function_">required</span>()<br><br><span class="hljs-comment">// 校验规则对象 - 添加分类</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">add_cate_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    name,<br>    alias,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，使用 <code>add_cate_schema</code> 对数据进行验证：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入验证数据的中间件</span><br><span class="hljs-keyword">const</span> expressJoi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@escook/express-joi&#x27;</span>)<br><span class="hljs-comment">// 导入文章分类的验证模块</span><br><span class="hljs-keyword">const</span> &#123; add_cate_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/artcate&#x27;</span>)<br><br><span class="hljs-comment">// 新增文章分类的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/addcates&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(add_cate_schema), artcate_handler.<span class="hljs-property">addArticleCates</span>)<br></code></pre></td></tr></table></figure><h4 id="4-3-3-查询分类名称与别名是否被占用"><a href="#4-3-3-查询分类名称与别名是否被占用" class="headerlink" title="4.3.3 查询分类名称与别名是否被占用"></a>4.3.3 查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_article_cate where name=? or alias=?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 执行查重操作</span><br>db.<span class="hljs-title function_">query</span>(sql, [req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">alias</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 判断 分类名称 和 分类别名 是否被占用</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)<br>  <span class="hljs-comment">// 分别判断 分类名称 和 分类别名 是否被占用</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; results[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> === req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; results[<span class="hljs-number">0</span>].<span class="hljs-property">alias</span> === req.<span class="hljs-property">body</span>.<span class="hljs-property">alias</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)<br><br>  <span class="hljs-comment">// TODO：新增文章分类</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="4-3-4-实现新增文章分类的功能"><a href="#4-3-4-实现新增文章分类的功能" class="headerlink" title="4.3.4 实现新增文章分类的功能"></a>4.3.4 实现新增文章分类的功能</h4><ol><li>定义新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`insert into ev_article_cate set ?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行新增文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, req.<span class="hljs-property">body</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// SQL 语句执行失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// SQL 语句执行成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;新增文章分类失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 新增文章分类成功</span><br>  res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;新增文章分类成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="4-4-根据-Id-删除文章分类"><a href="#4-4-根据-Id-删除文章分类" class="headerlink" title="4.4 根据 Id 删除文章分类"></a>4.4 根据 Id 删除文章分类</h3><h4 id="4-4-0-实现步骤"><a href="#4-4-0-实现步骤" class="headerlink" title="4.4.0 实现步骤"></a>4.4.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现删除文章分类的功能</li></ol><h4 id="4-4-1-定义路由和处理函数"><a href="#4-4-1-定义路由和处理函数" class="headerlink" title="4.4.1 定义路由和处理函数"></a>4.4.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>删除文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 删除文章分类的路由</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/deletecate/:id&#x27;</span>, artcate_handler.<span class="hljs-property">deleteCateById</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>删除文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 删除文章分类的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">deleteCateById</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-4-2-验证表单数据"><a href="#4-4-2-验证表单数据" class="headerlink" title="4.4.2 验证表单数据"></a>4.4.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，定义 id 的验证规则如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义 分类Id 的校验规则</span><br><span class="hljs-keyword">const</span> id = joi.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">integer</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">required</span>()<br></code></pre></td></tr></table></figure><ol start="2"><li>并使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 校验规则对象 - 删除分类</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">delete_cate_schema</span> = &#123;<br>  <span class="hljs-attr">params</span>: &#123;<br>    id,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入删除分类的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; delete_cate_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/artcate&#x27;</span>)<br><br><span class="hljs-comment">// 删除文章分类的路由</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/deletecate/:id&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(delete_cate_schema), artcate_handler.<span class="hljs-property">deleteCateById</span>)<br></code></pre></td></tr></table></figure><h4 id="4-4-3-实现删除文章分类的功能"><a href="#4-4-3-实现删除文章分类的功能" class="headerlink" title="4.4.3 实现删除文章分类的功能"></a>4.4.3 实现删除文章分类的功能</h4><ol><li>定义删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`update ev_article_cate set is_delete=1 where id=?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行删除文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// SQL 语句执行成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;删除文章分类失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 删除文章分类成功</span><br>  res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;删除文章分类成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="4-5-根据-Id-获取文章分类数据"><a href="#4-5-根据-Id-获取文章分类数据" class="headerlink" title="4.5 根据 Id 获取文章分类数据"></a>4.5 根据 Id 获取文章分类数据</h3><h4 id="4-5-0-实现步骤"><a href="#4-5-0-实现步骤" class="headerlink" title="4.5.0 实现步骤"></a>4.5.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>实现获取文章分类的功能</li></ol><h4 id="4-5-1-定义路由和处理函数"><a href="#4-5-1-定义路由和处理函数" class="headerlink" title="4.5.1 定义路由和处理函数"></a>4.5.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>根据 Id 获取文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/cates/:id&#x27;</span>, artcate_handler.<span class="hljs-property">getArticleById</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>根据 Id 获取文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 根据 Id 获取文章分类的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">getArticleById</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-5-2-验证表单数据"><a href="#4-5-2-验证表单数据" class="headerlink" title="4.5.2 验证表单数据"></a>4.5.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 校验规则对象 - 根据 Id 获取分类</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">get_cate_schema</span> = &#123;<br>  <span class="hljs-attr">params</span>: &#123;<br>    id,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入根据 Id 获取分类的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; get_cate_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/artcate&#x27;</span>)<br><br><span class="hljs-comment">// 根据 Id 获取文章分类的路由</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/cates/:id&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(get_cate_schema), artcate_handler.<span class="hljs-property">getArticleById</span>)<br></code></pre></td></tr></table></figure><h4 id="4-5-3-实现获取文章分类的功能"><a href="#4-5-3-实现获取文章分类的功能" class="headerlink" title="4.5.3 实现获取文章分类的功能"></a>4.5.3 实现获取文章分类的功能</h4><ol><li>定义根据 Id 获取文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_article_cate where id=?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// SQL 语句执行成功，但是没有查询到任何数据</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;获取文章分类数据失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 把数据响应给客户端</span><br>  res.<span class="hljs-title function_">send</span>(&#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;获取文章分类数据成功！&#x27;</span>,<br>    <span class="hljs-attr">data</span>: results[<span class="hljs-number">0</span>],<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="4-6-根据-Id-更新文章分类数据"><a href="#4-6-根据-Id-更新文章分类数据" class="headerlink" title="4.6 根据 Id 更新文章分类数据"></a>4.6 根据 Id 更新文章分类数据</h3><h4 id="4-6-0-实现步骤"><a href="#4-6-0-实现步骤" class="headerlink" title="4.6.0 实现步骤"></a>4.6.0 实现步骤</h4><ol><li>定义路由和处理函数</li><li>验证表单数据</li><li>查询 <code>分类名称</code> 与 <code>分类别名</code> 是否被占用</li><li>实现更新文章分类的功能</li></ol><h4 id="4-6-1-定义路由和处理函数"><a href="#4-6-1-定义路由和处理函数" class="headerlink" title="4.6.1 定义路由和处理函数"></a>4.6.1 定义路由和处理函数</h4><ol><li>在 <code>/router/artcate.js</code> 模块中，添加 <code>更新文章分类</code> 的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新文章分类的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/updatecate&#x27;</span>, artcate_handler.<span class="hljs-property">updateCateById</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/artcate.js</code> 模块中，定义并向外共享 <code>更新文章分类</code> 的路由处理函数：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 更新文章分类的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">updateCateById</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-6-2-验证表单数据"><a href="#4-6-2-验证表单数据" class="headerlink" title="4.6.2 验证表单数据"></a>4.6.2 验证表单数据</h4><ol><li>在 <code>/schema/artcate.js</code> 验证规则模块中，使用 <code>exports</code> 向外共享如下的 <code>验证规则对象</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 校验规则对象 - 更新分类</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">update_cate_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    <span class="hljs-title class_">Id</span>: id,<br>    name,<br>    alias,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/artcate.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入更新文章分类的验证规则对象</span><br><span class="hljs-keyword">const</span> &#123; update_cate_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/artcate&#x27;</span>)<br><br><span class="hljs-comment">// 更新文章分类的路由</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/updatecate&#x27;</span>, <span class="hljs-title function_">expressJoi</span>(update_cate_schema), artcate_handler.<span class="hljs-property">updateCateById</span>)<br></code></pre></td></tr></table></figure><h4 id="4-5-4-查询分类名称与别名是否被占用"><a href="#4-5-4-查询分类名称与别名是否被占用" class="headerlink" title="4.5.4 查询分类名称与别名是否被占用"></a>4.5.4 查询分类名称与别名是否被占用</h4><ol><li>定义查重的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义查询 分类名称 与 分类别名 是否被占用的 SQL 语句</span><br><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`select * from ev_article_cate where Id&lt;&gt;? and (name=? or alias=?)`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行查重的操作：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 执行查重操作</span><br>db.<span class="hljs-title function_">query</span>(sql, [req.<span class="hljs-property">body</span>.<span class="hljs-property">Id</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">alias</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 判断 分类名称 和 分类别名 是否被占用</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类名称与别名被占用，请更换后重试！&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; results[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> === req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类名称被占用，请更换后重试！&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; results[<span class="hljs-number">0</span>].<span class="hljs-property">alias</span> === req.<span class="hljs-property">body</span>.<span class="hljs-property">alias</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;分类别名被占用，请更换后重试！&#x27;</span>)<br><br>  <span class="hljs-comment">// TODO：更新文章分类</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="4-5-5-实现更新文章分类的功能"><a href="#4-5-5-实现更新文章分类的功能" class="headerlink" title="4.5.5 实现更新文章分类的功能"></a>4.5.5 实现更新文章分类的功能</h4><ol><li>定义更新文章分类的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`update ev_article_cate set ? where Id=?`</span><br></code></pre></td></tr></table></figure><ol start="2"><li>调用 <code>db.query()</code> 执行 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">db.<span class="hljs-title function_">query</span>(sql, [req.<span class="hljs-property">body</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">Id</span>], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// SQL 语句执行成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新文章分类失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 更新文章分类成功</span><br>  res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;更新文章分类成功！&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="5-文章管理"><a href="#5-文章管理" class="headerlink" title="5. 文章管理"></a>5. 文章管理</h2><h3 id="5-1-新建-ev-articles-表"><a href="#5-1-新建-ev-articles-表" class="headerlink" title="5.1 新建 ev_articles 表"></a>5.1 新建 ev_articles 表</h3><p><img src="/./images/4.jpg" alt="ev_articles表结构"></p><h3 id="5-2-发布新文章"><a href="#5-2-发布新文章" class="headerlink" title="5.2 发布新文章"></a>5.2 发布新文章</h3><h4 id="5-2-0-实现步骤"><a href="#5-2-0-实现步骤" class="headerlink" title="5.2.0 实现步骤"></a>5.2.0 实现步骤</h4><ol><li>初始化路由模块</li><li>初始化路由处理函数模块</li><li>使用 multer 解析表单数据</li><li>验证表单数据</li><li>实现发布文章的功能</li></ol><h4 id="5-2-1-初始化路由模块"><a href="#5-2-1-初始化路由模块" class="headerlink" title="5.2.1 初始化路由模块"></a>5.2.1 初始化路由模块</h4><ol><li>创建 <code>/router/article.js</code> 路由模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 express</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建路由对象</span><br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 发布新文章</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/add&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 向外共享路由对象</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>app.js</code> 中导入并使用文章的路由模块：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入并使用文章路由模块</span><br><span class="hljs-keyword">const</span> articleRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./router/article&#x27;</span>)<br><span class="hljs-comment">// 为文章的路由挂载统一的访问前缀 /my/article</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/my/article&#x27;</span>, articleRouter)<br></code></pre></td></tr></table></figure><h4 id="5-2-2-初始化路由处理函数模块"><a href="#5-2-2-初始化路由处理函数模块" class="headerlink" title="5.2.2 初始化路由处理函数模块"></a>5.2.2 初始化路由处理函数模块</h4><ol><li>创建 <code>/router_handler/article.js</code> 路由处理函数模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 发布新文章的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">addArticle</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>修改 <code>/router/article.js</code> 中的代码如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()<br><br><span class="hljs-comment">// 导入文章的路由处理函数模块</span><br><span class="hljs-keyword">const</span> article_handler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../router_handler/article&#x27;</span>)<br><br><span class="hljs-comment">// 发布新文章</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/add&#x27;</span>, article_handler.<span class="hljs-property">addArticle</span>)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br></code></pre></td></tr></table></figure><h4 id="5-2-3-使用-multer-解析表单数据"><a href="#5-2-3-使用-multer-解析表单数据" class="headerlink" title="5.2.3 使用 multer 解析表单数据"></a>5.2.3 使用 multer 解析表单数据</h4><blockquote><p>注意：使用 <code>express.urlencoded()</code> 中间件无法解析 <code>multipart/form-data</code> 格式的请求体数据。</p></blockquote><blockquote><p>当前项目，推荐使用 multer 来解析 <code>multipart/form-data</code> 格式的表单数据。<a href="https://www.npmjs.com/package/multer">https://www.npmjs.com/package/multer</a></p></blockquote><ol><li>运行如下的终端命令，在项目中安装 <code>multer</code>：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i multer@1.4.2<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router_handler/article.js</code> 模块中导入并配置 <code>multer</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入解析 formdata 格式表单数据的包</span><br><span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;multer&#x27;</span>)<br><span class="hljs-comment">// 导入处理路径的核心模块</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<br><br><span class="hljs-comment">// 创建 multer 的实例对象，通过 dest 属性指定文件的存放路径</span><br><span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>(&#123; <span class="hljs-attr">dest</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;../uploads&#x27;</span>) &#125;)<br></code></pre></td></tr></table></figure><ol start="3"><li>修改 <code>发布新文章</code> 的路由如下：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 发布新文章的路由</span><br><span class="hljs-comment">// upload.single() 是一个局部生效的中间件，用来解析 FormData 格式的表单数据</span><br><span class="hljs-comment">// 将文件类型的数据，解析并挂载到 req.file 属性中</span><br><span class="hljs-comment">// 将文本类型的数据，解析并挂载到 req.body 属性中</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/add&#x27;</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">&#x27;cover_img&#x27;</span>), article_handler.<span class="hljs-property">addArticle</span>)<br></code></pre></td></tr></table></figure><ol start="4"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，将 <code>multer</code> 解析出来的数据进行打印：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 发布新文章的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">addArticle</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">body</span>) <span class="hljs-comment">// 文本类型的数据</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;--------分割线----------&#x27;</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">file</span>) <span class="hljs-comment">// 文件类型的数据</span><br><br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="5-2-4-验证表单数据"><a href="#5-2-4-验证表单数据" class="headerlink" title="5.2.4 验证表单数据"></a>5.2.4 验证表单数据</h4><blockquote><p>实现思路：通过 express-joi <strong>自动验证</strong> req.body 中的文本数据；通过 if 判断<strong>手动验证</strong> req.file 中的文件数据；</p></blockquote><ol><li>创建 <code>/schema/article.js</code> 验证规则模块，并初始化如下的代码结构：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入定义验证规则的模块</span><br><span class="hljs-keyword">const</span> joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@hapi/joi&#x27;</span>)<br><br><span class="hljs-comment">// 定义 标题、分类Id、内容、发布状态 的验证规则</span><br><span class="hljs-keyword">const</span> title = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>()<br><span class="hljs-keyword">const</span> cate_id = joi.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">integer</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">required</span>()<br><span class="hljs-keyword">const</span> content = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">required</span>().<span class="hljs-title function_">allow</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">const</span> state = joi.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">valid</span>(<span class="hljs-string">&#x27;已发布&#x27;</span>, <span class="hljs-string">&#x27;草稿&#x27;</span>).<span class="hljs-title function_">required</span>()<br><br><span class="hljs-comment">// 验证规则对象 - 发布文章</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">add_article_schema</span> = &#123;<br>  <span class="hljs-attr">body</span>: &#123;<br>    title,<br>    cate_id,<br>    content,<br>    state,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>在 <code>/router/article.js</code> 模块中，导入需要的验证规则对象，并在路由中使用：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入验证数据的中间件</span><br><span class="hljs-keyword">const</span> expressJoi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@escook/express-joi&#x27;</span>)<br><span class="hljs-comment">// 导入文章的验证模块</span><br><span class="hljs-keyword">const</span> &#123; add_article_schema &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../schema/article&#x27;</span>)<br><br><span class="hljs-comment">// 发布新文章的路由</span><br><span class="hljs-comment">// 注意：在当前的路由中，先后使用了两个中间件：</span><br><span class="hljs-comment">//       先使用 multer 解析表单数据</span><br><span class="hljs-comment">//       再使用 expressJoi 对解析的表单数据进行验证</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/add&#x27;</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">&#x27;cover_img&#x27;</span>), <span class="hljs-title function_">expressJoi</span>(add_article_schema), article_handler.<span class="hljs-property">addArticle</span>)<br></code></pre></td></tr></table></figure><ol start="3"><li>在 <code>/router_handler/article.js</code> 模块中的 <code>addArticle</code> 处理函数中，通过 <code>if</code> 判断客户端是否提交了 <code>封面图片</code>：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 发布新文章的处理函数</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">addArticle</span> = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 手动判断是否上传了文章封面</span><br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">file</span> || req.<span class="hljs-property">file</span>.<span class="hljs-property">fieldname</span> !== <span class="hljs-string">&#x27;cover_img&#x27;</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;文章封面是必选参数！&#x27;</span>)<br><br>  <span class="hljs-comment">// TODO：表单数据合法，继续后面的处理流程...</span><br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="5-2-5-实现发布文章的功能"><a href="#5-2-5-实现发布文章的功能" class="headerlink" title="5.2.5 实现发布文章的功能"></a>5.2.5 实现发布文章的功能</h4><ol><li>整理要插入数据库的文章信息对象：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入处理路径的 path 核心模块</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<br><br><span class="hljs-keyword">const</span> articleInfo = &#123;<br>  <span class="hljs-comment">// 标题、内容、状态、所属的分类Id</span><br>  ...req.<span class="hljs-property">body</span>,<br>  <span class="hljs-comment">// 文章封面在服务器端的存放路径</span><br>  <span class="hljs-attr">cover_img</span>: path.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;/uploads&#x27;</span>, req.<span class="hljs-property">file</span>.<span class="hljs-property">filename</span>),<br>  <span class="hljs-comment">// 文章发布时间</span><br>  <span class="hljs-attr">pub_date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),<br>  <span class="hljs-comment">// 文章作者的Id</span><br>  <span class="hljs-attr">author_id</span>: req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>,<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>定义发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sql = <span class="hljs-string">`insert into ev_articles set ?`</span><br></code></pre></td></tr></table></figure><ol start="3"><li>调用 <code>db.query()</code> 执行发布文章的 SQL 语句：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入数据库操作模块</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../db/index&#x27;</span>)<br><br><span class="hljs-comment">// 执行 SQL 语句</span><br>db.<span class="hljs-title function_">query</span>(sql, articleInfo, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 执行 SQL 语句失败</span><br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(err)<br><br>  <span class="hljs-comment">// 执行 SQL 语句成功，但是影响行数不等于 1</span><br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">affectedRows</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;发布文章失败！&#x27;</span>)<br><br>  <span class="hljs-comment">// 发布文章成功</span><br>  res.<span class="hljs-title function_">cc</span>(<span class="hljs-string">&#x27;发布文章成功&#x27;</span>, <span class="hljs-number">0</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><ol start="4"><li>在 <code>app.js</code> 中，使用 <code>express.static()</code> 中间件，将 <code>uploads</code> 目录中的图片托管为静态资源：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 托管静态资源文件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/uploads&#x27;</span>, express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;./uploads&#x27;</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/09/28/hello-world/"/>
    <url>/2024/09/28/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HEXO搭建博客平台</title>
    <link href="/2024/09/28/%E5%88%A9%E7%94%A8HEXO%E6%90%AD%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    <url>/2024/09/28/%E5%88%A9%E7%94%A8HEXO%E6%90%AD%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="HEXO搭建博客平台"><a href="#HEXO搭建博客平台" class="headerlink" title="HEXO搭建博客平台"></a>HEXO搭建博客平台</h1><h2 id="本机环境"><a href="#本机环境" class="headerlink" title="本机环境"></a>本机环境</h2><ul><li>Win11</li><li>node.js：18.17.0</li><li>npm：10.8.2</li></ul><h2 id="安装下载hexo"><a href="#安装下载hexo" class="headerlink" title="安装下载hexo"></a>安装下载hexo</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g hexo-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure><blockquote><p>hexo -v 验证并查看版本</p></blockquote><h2 id="创建项目文件夹"><a href="#创建项目文件夹" class="headerlink" title="创建项目文件夹"></a>创建项目文件夹</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">hexo <span class="hljs-keyword">init</span> myblog<br></code></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> myblog<br>npm install<br></code></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo g<br>hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><h2 id="在GitHub创建仓库"><a href="#在GitHub创建仓库" class="headerlink" title="在GitHub创建仓库"></a>在GitHub创建仓库</h2><h2 id="安装hexo上传插件"><a href="#安装hexo上传插件" class="headerlink" title="安装hexo上传插件"></a>安装hexo上传插件</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install hexo-deployer-git <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><h2 id="修改hexo配置文件指定仓库路径"><a href="#修改hexo配置文件指定仓库路径" class="headerlink" title="修改hexo配置文件指定仓库路径"></a>修改hexo配置文件指定仓库路径</h2><p>在文件夹中直接打开<code>_config.yml</code>文件修改</p><p>deploy: </p><p>​type: git</p><p>​repo : git地址</p><p>​branch: master</p><h2 id="推送到GitHub"><a href="#推送到GitHub" class="headerlink" title="推送到GitHub"></a>推送到GitHub</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo d</span><br></code></pre></td></tr></table></figure><blockquote><p>跟新完</p><p>清理：hexo clean</p><p>构建：hexo g</p><p>上传：hexo d</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>青队云平台开发</title>
    <link href="/2024/09/04/%E9%9D%92%E9%98%9F%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/"/>
    <url>/2024/09/04/%E9%9D%92%E9%98%9F%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="青队云平台开发文档💕"><a href="#青队云平台开发文档💕" class="headerlink" title="青队云平台开发文档💕"></a>青队云平台开发文档💕</h1><p>启动时间：2024.09.04</p><h2 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着志愿服务在高校中的蓬勃发展，“小红帽”常青藤青年志愿者服务队【以下简称青队】逐渐成为学院内外各类公益活动的重要组织者。作为一个由热心青年学生组成的志愿者队伍，我们的成员在多个领域积极参与，展现了良好的精神风貌和社会责任感。为了更好地提升服务队的内部管理和对外宣传，我们希望通过开发一个内部管理和展示平台，强化队伍凝聚力和成员归属感，同时向公众展示我们的成果和精神风貌。</p><h3 id="当前问题和挑战"><a href="#当前问题和挑战" class="headerlink" title="当前问题和挑战"></a>当前问题和挑战</h3><p><strong>1、队伍形象展示不足</strong>：服务队在学院和社会上的影响力有限，缺乏一个集中展示服务队历史、成就和活动的窗口，使外界难以充分了解我们的团队文化和核心价值观。</p><p><strong>2、信息发布不及时</strong>：当前活动和内部信息的发布主要依赖于微信群、QQ群等非集中化渠道，容易导致信息遗漏或传播不及时，影响活动的参与率和团队沟通效率。</p><p><strong>3、志愿精神传递不足</strong>：在提升成员志愿服务精神、技能培训和经验分享方面缺少有效的工具和手段，难以为新成员提供系统性的成长路径和支持。</p><h3 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h3><p>本项目旨在为青队开发一个专属的云平台，以解决以上问题，并实现以下目标：</p><p><strong>1、展示队伍形象和成就</strong>：通过平台展示服务队的历史、团队文化、活动成果和优秀队员的风采，加强公众对服务队的认识和支持。</p><p><strong>2、提升信息发布和沟通效率</strong>：通过平台发布公告、活动预告和内部信息，确保成员能够及时获取最新信息，提升队内沟通效率。</p><p><strong>3、促进志愿精神传播与成长</strong>：提供志愿者学习资源、经验分享和培训支持，帮助成员成长，并有效传播志愿服务精神。</p><h2 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h2><h3 id="用户登录信息表（user-auth"><a href="#用户登录信息表（user-auth" class="headerlink" title="用户登录信息表（user_auth)"></a>用户登录信息表（user_auth)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `user_login` (<br>  `auth_id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;认证ID&#x27;</span>,<br>  `student_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;学号&#x27;</span>,<br>  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;邮箱，要求@ctbu.edu.cn结尾&#x27;</span>,<br>  `password_hash` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;密码哈希值&#x27;</span>,<br>  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;账号创建时间&#x27;</span>,<br>  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;最后更新时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`auth_id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `unique_email` (`email`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `unique_student_id` (`student_id`)<br>);<br></code></pre></td></tr></table></figure><p><strong>触发器</strong></p><ul><li><p>注册时同步创建一个新的用户信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br>  <span class="hljs-comment">-- 插入到 user_info 中，并将 username 设置为 student_id</span><br>  <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `user_info` (auth_id, username)<br>  <span class="hljs-keyword">VALUES</span> (NEW.auth_id, NEW.student_id);<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="用户详细信息表-user-info"><a href="#用户详细信息表-user-info" class="headerlink" title="用户详细信息表(user_info)"></a>用户详细信息表(user_info)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `user_info` (<br>  `auth_id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;关联认证表的外键&#x27;</span>,<br>  `role` tinyint <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;用户角色（0=普通用户, 1=超级管理员, 2=普通管理员）&#x27;</span>,<br>  `nickname` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">18</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;真实姓名&#x27;</span>,<br>  `gender` tinyint <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;性别（0=未指定, 1=男, 2=女）&#x27;</span>,<br>  `avatar` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;头像URL&#x27;</span>,<br>  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;手机号&#x27;</span>,<br>  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`auth_id`),<br>  <span class="hljs-keyword">CONSTRAINT</span> `user_info_ibfk_1` <span class="hljs-keyword">FOREIGN</span> KEY (`auth_id`) <span class="hljs-keyword">REFERENCES</span> `user_login` (`auth_id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE<br>);<br></code></pre></td></tr></table></figure><h2 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h2><h3 id="首页（-home）"><a href="#首页（-home）" class="headerlink" title="首页（&#x2F;home）"></a>首页（&#x2F;home）</h3><ul><li><input checked="" disabled="" type="checkbox"> 轮播图</li><li><input checked="" disabled="" type="checkbox"> 小公告</li><li><input checked="" disabled="" type="checkbox"> 队徽队名</li><li><input checked="" disabled="" type="checkbox"> 功能宫格【校园服务通、爱心雨伞、服务队活动风采、志愿活动报名、关于青队、用户意见反馈】</li></ul><h3 id="个人中心（-user）"><a href="#个人中心（-user）" class="headerlink" title="个人中心（&#x2F;user）"></a>个人中心（&#x2F;user）</h3><ul><li>未登录情况<ul><li><input disabled="" type="checkbox"> 默认登录栏（默认头像、点击登录）</li><li><input disabled="" type="checkbox"> 选择列表（个人资料、权限申请、使用指南、设置）【需要登录之后才能点击使用】</li></ul></li><li>已登录情况<ul><li><input disabled="" type="checkbox"> 已登录状态栏（登录头像、名称）</li><li><input disabled="" type="checkbox"> 选择列表（个人资料、权限申请（审核）、?后台管理、使用指南、设置）</li></ul></li></ul><h3 id="关于青队（About-Us）"><a href="#关于青队（About-Us）" class="headerlink" title="关于青队（About Us）"></a>关于青队（About Us）</h3><h2 id="前端开发"><a href="#前端开发" class="headerlink" title="前端开发"></a>前端开发</h2><h3 id="创建前端项目"><a href="#创建前端项目" class="headerlink" title="创建前端项目"></a>创建前端项目</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pnpm create vue</span><br></code></pre></td></tr></table></figure><h3 id="配置Vant"><a href="#配置Vant" class="headerlink" title="配置Vant"></a>配置Vant</h3><p>添加vant</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pnpm <span class="hljs-built_in">add</span> vant<br></code></pre></td></tr></table></figure><p>安装自动导入插件</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs d">pnpm add <span class="hljs-keyword">@vant</span>/<span class="hljs-keyword">auto</span>-<span class="hljs-keyword">import</span>-resolver unplugin-vue-components unplugin-<span class="hljs-keyword">auto</span>-<span class="hljs-keyword">import</span> -D<br></code></pre></td></tr></table></figure><p>配置自动导入</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; fileURLToPath, <span class="hljs-variable constant_">URL</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;node:url&#x27;</span><br><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-auto-import/vite&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/vite&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">VantResolver</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vant/auto-import-resolver&#x27;</span>;<br><br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-title function_">vue</span>(),<br>    <span class="hljs-title class_">AutoImport</span>(&#123;<br>      <span class="hljs-comment">// vant按需导入</span><br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],<br>    &#125;),<br>    <span class="hljs-title class_">Components</span>(&#123;<br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],<br>    &#125;)<br>  ],<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;./src&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="配置自动导入和组件"><a href="#配置自动导入和组件" class="headerlink" title="配置自动导入和组件"></a>配置自动导入和组件</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-title class_">AutoImport</span>(&#123;<br>     <span class="hljs-attr">include</span>: [<br>       <span class="hljs-regexp">/\.[tj]sx?$/</span>, <span class="hljs-comment">// .ts, .tsx, .js, .jsx</span><br>       <span class="hljs-regexp">/\.vue$/</span>,<br>       <span class="hljs-regexp">/\.vue\?vue/</span>, <span class="hljs-comment">// .vue</span><br>       <span class="hljs-regexp">/\.md$/</span> <span class="hljs-comment">// .md</span><br>     ],<br>     <span class="hljs-attr">imports</span>: [<span class="hljs-string">&#x27;vue&#x27;</span>, <span class="hljs-string">&#x27;vue-router&#x27;</span>, <span class="hljs-string">&#x27;pinia&#x27;</span>], <span class="hljs-comment">// 配置导出的文件</span><br>     <span class="hljs-attr">dts</span>: <span class="hljs-string">&#x27;src/auto-import.d.ts&#x27;</span>, <span class="hljs-comment">// vue、vue-router ts类型导出位置</span><br>     <span class="hljs-comment">// vant按需导入</span><br>     <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],<br>     <span class="hljs-comment">// eslint 配置</span><br>     <span class="hljs-attr">eslintrc</span>: &#123;<br>       <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 当配置 enabled: true 时，会根据 filepath 配置的路径生成一个 .eslintrc-auto-import.json 文件</span><br>       <span class="hljs-attr">filepath</span>: <span class="hljs-string">&#x27;src/.eslintrc-auto-import.json&#x27;</span>,<br>       <span class="hljs-attr">globalsPropValue</span>: <span class="hljs-literal">true</span><br>     &#125;<br>   &#125;),<br>   <span class="hljs-title class_">Components</span>(&#123;<br>     <span class="hljs-comment">// 搜索子目录</span><br>     <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>,<br>     <span class="hljs-comment">// 组件有效的扩展名</span><br>     <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;vue&#x27;</span>, <span class="hljs-string">&#x27;js&#x27;</span>, <span class="hljs-string">&#x27;jsx&#x27;</span>, <span class="hljs-string">&#x27;ts&#x27;</span>, <span class="hljs-string">&#x27;tsx&#x27;</span>, <span class="hljs-string">&#x27;.mjs&#x27;</span>],<br>     <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/\.vue$/</span>, <span class="hljs-regexp">/\.vue\?vue/</span>, <span class="hljs-regexp">/\.js$/</span>, <span class="hljs-regexp">/\.jsx$/</span>, <span class="hljs-regexp">/\.ts$/</span>, <span class="hljs-regexp">/\.tsx$/</span>],<br>     <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],<br>     <span class="hljs-attr">dirs</span>: [<span class="hljs-string">&#x27;src/components&#x27;</span>],<br>     <span class="hljs-attr">dts</span>: <span class="hljs-string">&#x27;src/components.d.ts&#x27;</span>,<br>     <span class="hljs-attr">directives</span>: <span class="hljs-literal">true</span><br>   &#125;)<br></code></pre></td></tr></table></figure><h3 id="配置Eslint和Prettier"><a href="#配置Eslint和Prettier" class="headerlink" title="配置Eslint和Prettier"></a>配置Eslint和Prettier</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">rules</span>: &#123;<br>  <span class="hljs-string">&#x27;prettier/prettier&#x27;</span>: [<br>    <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    &#123;<br>      <span class="hljs-attr">singleQuote</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">semi</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">printWidth</span>: <span class="hljs-number">100</span>,<br>      <span class="hljs-attr">trailingComma</span>: <span class="hljs-string">&#x27;none&#x27;</span>,<br>      <span class="hljs-attr">endOfLine</span>: <span class="hljs-string">&#x27;auto&#x27;</span><br>    &#125;<br>  ],<br><br>  <span class="hljs-string">&#x27;vue/multi-word-component-names&#x27;</span>: [<br>    <span class="hljs-string">&#x27;warn&#x27;</span>,<br>    &#123;<br>      <span class="hljs-attr">ignores</span>: [<span class="hljs-string">&#x27;index&#x27;</span>]<br>    &#125;<br>  ],<br>  <span class="hljs-string">&#x27;vue/no-setup-props-destructure&#x27;</span>: [<span class="hljs-string">&#x27;off&#x27;</span>]<br>  <span class="hljs-comment">// &#x27;no-undef&#x27;: &#x27;error&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="配置Viewport"><a href="#配置Viewport" class="headerlink" title="配置Viewport"></a>配置Viewport</h3><p>安装插件</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tsx">pnpm install postcss-px-to-viewport -D<br></code></pre></td></tr></table></figure><p>配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* eslint-env node */</span><br><span class="hljs-comment">// postcss.config.cjs</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: &#123;<br>    <span class="hljs-string">&#x27;postcss-px-to-viewport&#x27;</span>: &#123;<br>      <span class="hljs-attr">uniToConvert</span>: <span class="hljs-string">&#x27;px&#x27;</span>, <span class="hljs-comment">// 需要转换的单位 &#x27;默认px&#x27;</span><br>      <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">375</span>, <span class="hljs-comment">// 设计稿的视口宽度</span><br>      <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 单位转换后保留的小数位数</span><br>      <span class="hljs-attr">proList</span>: [<span class="hljs-string">&#x27;*&#x27;</span>], <span class="hljs-comment">// 要进行转换的属性列表 ,*表示匹配所有</span><br>      <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">&#x27;vw&#x27;</span>, <span class="hljs-comment">// 转换后的视口单位</span><br>      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">&#x27;.ignore&#x27;</span>, <span class="hljs-string">&#x27;.hairlines&#x27;</span>], <span class="hljs-comment">// 不转换的选择器列表</span><br>      <span class="hljs-attr">fontViewportUnit</span>: <span class="hljs-string">&#x27;vw&#x27;</span>, <span class="hljs-comment">// 转换后字体使用的视口单位</span><br>      <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 设置最小的转换数值</span><br>      <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否直接转化而不添加备用属性</span><br>      <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否允许在媒体查询中转换</span><br>      <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/node_modules/</span>] <span class="hljs-comment">// 忽略某些文件夹下的文件 </span><br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="配置Axios"><a href="#配置Axios" class="headerlink" title="配置Axios"></a>配置Axios</h3><p>安装Axios</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pnpm <span class="hljs-built_in">add</span> axios<br></code></pre></td></tr></table></figure><p>配置Request文件</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">InternalAxiosRequestConfig</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span><br><span class="hljs-keyword">import</span> &#123; getLocalData, removeLocalData, isLogin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/util&#x27;</span><br><br><span class="hljs-comment">// 自定义请求配置接口，扩展了 Axios 的配置选项，增加了 needToken 属性</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomRequestConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InternalAxiosRequestConfig</span> &#123;<br>  needToken?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// 标识请求是否需要携带Token</span><br>&#125;<br><br><span class="hljs-comment">// 创建axios实例，并设置基础配置</span><br><span class="hljs-keyword">const</span> http = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">baseURL</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_BASE_URL</span>, <span class="hljs-comment">// API的基础URL，使用Vite的环境变量来设置</span><br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span> <span class="hljs-comment">// 请求超时时间为10秒</span><br>&#125;)<br><br><span class="hljs-comment">// 请求拦截器：在请求发送之前做一些处理</span><br>http.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">config</span>: <span class="hljs-title class_">CustomRequestConfig</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 判断当前请求是否需要Token</span><br>    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">needToken</span>) &#123;<br>      <span class="hljs-comment">// 检查是否已登录</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isLogin</span>()) &#123;<br>        <span class="hljs-comment">// 从本地存储中获取用户信息</span><br>        <span class="hljs-keyword">const</span> userinfo = <span class="hljs-title function_">getLocalData</span>(<span class="hljs-string">&#x27;userinfo&#x27;</span>)<br>        <span class="hljs-keyword">if</span> (userinfo) &#123;<br>          <span class="hljs-comment">// 如果用户信息存在，将Token添加到请求头中</span><br>          config.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Authorization&#x27;</span>] = <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;userinfo.sk&#125;</span>`</span> <span class="hljs-comment">// sk 为用户密钥字段</span><br>        &#125;<br>      &#125;<br>      <span class="hljs-comment">// 如果用户未登录，但本地有Token过期时间</span><br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getLocalData</span>(<span class="hljs-string">&#x27;token_expires_at&#x27;</span>)) &#123;<br>        <span class="hljs-comment">// 移除过期的用户信息和Token</span><br>        <span class="hljs-title function_">removeLocalData</span>(<span class="hljs-string">&#x27;userinfo&#x27;</span>)<br>        <span class="hljs-title function_">removeLocalData</span>(<span class="hljs-string">&#x27;token_expires_at&#x27;</span>)<br>        <span class="hljs-comment">// 提示用户登录已过期</span><br>        <span class="hljs-title function_">showFailToast</span>(<span class="hljs-string">&#x27;登录已过期，请重新登录&#x27;</span>)<br>      &#125;<br>      <span class="hljs-comment">// 用户未登录且没有过期的Token</span><br>      <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 提示用户先登录</span><br>        <span class="hljs-title function_">showFailToast</span>(<span class="hljs-string">&#x27;请先登录&#x27;</span>)<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 为所有请求设置请求头，指定请求内容类型为x-www-form-urlencoded</span><br>    config.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span><br><br>    <span class="hljs-comment">// 返回处理后的请求配置</span><br>    <span class="hljs-keyword">return</span> config<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 如果请求发生错误，直接返回错误</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)<br>  &#125;<br>)<br><br><span class="hljs-comment">// 响应拦截器：在响应返回之后做一些处理</span><br>http.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 只返回响应的data部分，简化后续调用的数据处理</span><br>    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span><br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 如果响应发生错误，返回错误</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)<br>  &#125;<br>)<br><br><span class="hljs-comment">// 导出处理好的 http 实例</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> http<br></code></pre></td></tr></table></figure><h3 id="配置Pinia"><a href="#配置Pinia" class="headerlink" title="配置Pinia"></a>配置Pinia</h3><p>安装插件</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pnpm <span class="hljs-built_in">add</span> pinia-plugin-persistedstate -D<br></code></pre></td></tr></table></figure><p>在仓库中导入</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; createPinia &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><span class="hljs-keyword">import</span> persist <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia-plugin-persistedstate&#x27;</span><br><br><span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()<br>pinia.<span class="hljs-title function_">use</span>(persist)<br><br><span class="hljs-keyword">import</span> &#123; useCounterStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./counter&#x27;</span> <span class="hljs-comment">// 举例导入</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> pinia<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useStore</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">counter</span>: <span class="hljs-title function_">useCounterStore</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="配置Vant底部安全区适配"><a href="#配置Vant底部安全区适配" class="headerlink" title="配置Vant底部安全区适配"></a>配置Vant底部安全区适配</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">/* index.html */<br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./css/viewportFit.css&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* viewportFit.css */</span><br><span class="hljs-comment">/* 适配 iphone 底部安全区（指示条，配合index.html &lt;meta name=&quot;viewport&quot; ... /&gt;使用 */</span><br><span class="hljs-keyword">@supports</span> (<span class="hljs-attribute">bottom</span>: env(safe-area-inset-bottom))&#123;<br>    <span class="hljs-selector-id">#app</span> &#123;<br>        <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-built_in">constant</span>(safe-area-inset-bottom);<span class="hljs-comment">/* 兼容ios&lt;11.2 */</span><br>        <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-built_in">env</span>(safe-area-inset-bottom);<span class="hljs-comment">/* 兼容ios&gt;=11.2 */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="配置全局样式"><a href="#配置全局样式" class="headerlink" title="配置全局样式"></a>配置全局样式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* src/styles/index.css */</span><br><br><span class="hljs-selector-id">#app</span> &#123;<br>  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1280px</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span>;<br>  <span class="hljs-attribute">font-weight</span>: normal;<br>&#125;<br><br><span class="hljs-selector-tag">html</span> &#123;<br>  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.2</span>;<br>&#125;<br><br><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">194</span>, <span class="hljs-number">194</span>, <span class="hljs-number">194</span>, <span class="hljs-number">0.131</span>);<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;KaiTi&#x27;</span>, <span class="hljs-string">&#x27;楷体&#x27;</span>, <span class="hljs-string">&#x27;STKaiti&#x27;</span>, <span class="hljs-string">&#x27;SimSun&#x27;</span>, <span class="hljs-string">&#x27;黑体&#x27;</span>, <span class="hljs-string">&#x27;Heiti SC&#x27;</span>, <span class="hljs-string">&#x27;Arial&#x27;</span>, sans-serif;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#3e3e3e</span>; <br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br><br><span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>, <span class="hljs-selector-tag">h5</span>, <span class="hljs-selector-tag">h6</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#222</span>; <br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;KaiTi&#x27;</span>, <span class="hljs-string">&#x27;楷体&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> indexRoutes <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./routes&#x27;</span><br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHashHistory</span>(),<br>  <span class="hljs-attr">routes</span>: [<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>      <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/home&#x27;</span>,<br>      <span class="hljs-attr">children</span>: [<br>        &#123;<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/home&#x27;</span>,<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Home&#x27;</span>,<br>          <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/Home/HomeView.vue&#x27;</span>)<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user&#x27;</span>,<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;User&#x27;</span>,<br>          <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/User/UserView.vue&#x27;</span>)<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/notice&#x27;</span>,<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Notice&#x27;</span>,<br>          <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/Notice/NoticeView.vue&#x27;</span>)<br>        &#125;<br>      ]<br>    &#125;,<br>    ...indexRoutes <span class="hljs-comment">//基础功能页面</span><br>  ]<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><p>其他路由</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/* indexRoutes.ts */</span><br><span class="hljs-keyword">const</span> routes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/campusservice&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;CampusService&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/CampusService/CampusService.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/loveumbrella&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;LoveUmbrella&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/LoveUmbrella/LoveUmbrella.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/activities&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Activities&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/Activities/Activities.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/signup&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;SignUp&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/SignUp/SignUp.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/aboutus&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;AboutUs&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/AboutUs/AboutUs.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/feedback&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Feedback&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/Feedback/Feedback.vue&#x27;</span>)<br>  &#125;<br>]<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> routes<br></code></pre></td></tr></table></figure><h3 id="配置阿里图标"><a href="#配置阿里图标" class="headerlink" title="配置阿里图标"></a>配置阿里图标</h3><ul><li>在阿里图标官网创建项目，并将选好的图标保存到项目中，再将项目下载下来</li><li>把下载的项目中的文件（除了demo.css和demo_index.html文件）保存至该项目中</li><li>在main.ts中导入iconfont.css文件</li><li>在项目中使用<code>icon=&quot; icon-great-activities&quot; icon-prefix=&quot;iconfont&quot;</code>【需要注意的是图标类名前必须加一个空格】</li></ul><h3 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>const route = useRoute()<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;layout&quot;&gt;<br>    &lt;router-view&gt;&lt;/router-view&gt;<br><br>    &lt;van-tabbar<br>      route<br>      v-if=&quot;[&#x27;/&#x27;, &#x27;/home&#x27;, &#x27;/notice&#x27;, &#x27;/user&#x27;].includes(route.path)&quot;<br>      active-color=&quot;#1989fa&quot;<br>      inactive-color=&quot;#000&quot;<br>      placeholder<br>    &gt;<br>      &lt;van-tabbar-item replace to=&quot;/home&quot; icon=&quot;home-o&quot;&gt; 首页 &lt;/van-tabbar-item&gt;<br><br>      &lt;!-- 这里的`dot`红点通过判断是否有新更新的通知来控制 --&gt;<br>      &lt;van-tabbar-item replace to=&quot;/notice&quot; icon=&quot;chat-o&quot; :dot=&quot;false&quot;&gt;<br>        通知<br>      &lt;/van-tabbar-item&gt;<br><br>      &lt;van-tabbar-item replace to=&quot;/user&quot; icon=&quot;user-o&quot;&gt;<br>        个人中心<br>      &lt;/van-tabbar-item&gt;<br>    &lt;/van-tabbar&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.van-tabbar-item &#123;<br>  background-color: rgb(255, 255, 255);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>// 定义一个响应式的文本变量，需要通过后端来控制文本内容，组件挂载（onMounted）时axios发请求<br>const notification = ref&lt;string&gt;(&#x27;内容待管理员更新...&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;home-layout&quot;&gt;<br>    &lt;!-- 轮播图 --&gt;<br>    &lt;HomeSwipe /&gt;<br>    &lt;!-- 小公告 --&gt;<br>    &lt;HomeNoticeBar :notification=&quot;notification&quot; /&gt;<br>    &lt;!-- 队徽队名 --&gt;<br>    &lt;HomeTeamName /&gt;<br>    &lt;!-- 功能表 --&gt;<br>    &lt;HomeGrid /&gt;<br>    &lt;!-- 底线 --&gt;<br>    &lt;Divider dividerText=&quot;暂时没有更多功能&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页-轮播图"><a href="#首页-轮播图" class="headerlink" title="首页-轮播图"></a>首页-轮播图</h3><ul><li>图片更新需要改成后端更新图片</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* components/HomeSwipe/index.vue */<br>&lt;script setup lang=&quot;ts&quot;&gt;<br>// 需要改成后端调用更新图片<br>const SwipeImages = reactive([<br>  &#123;<br>    imgUrl: &#x27;https://olrando.oss-cn-chengdu.aliyuncs.com/img/duiqi.jpg&#x27;,<br>    index: 0<br>  &#125;,<br>  &#123;<br>    imgUrl: &#x27;https://olrando.oss-cn-chengdu.aliyuncs.com/img/1681282717068.jpeg&#x27;,<br>    index: 1<br>  &#125;,<br>  &#123;<br>    imgUrl: &#x27;https://olrando.oss-cn-chengdu.aliyuncs.com/img/1681282717071.jpeg&#x27;,<br>    index: 2<br>  &#125;,<br>  &#123;<br>    imgUrl: &#x27;https://olrando.oss-cn-chengdu.aliyuncs.com/img/1681282717075.jpeg&#x27;,<br>    index: 3<br>  &#125;<br>])<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;swipe-container&quot;&gt;<br>    &lt;!-- 轮播图上层部分 --&gt;<br>    &lt;div class=&quot;foreground&quot;&gt;<br>      &lt;van-swipe<br>        loop<br>        class=&quot;my-swipe-fore&quot;<br>        :autoplay=&quot;3000&quot;<br>        indicator-color=&quot;#1989fa&quot;<br>        :touchable=&quot;false&quot;<br>      &gt;<br>        &lt;van-swipe-item v-for=&quot;item in SwipeImages&quot; :key=&quot;item.index&quot;&gt;<br>          &lt;img :src=&quot;item.imgUrl&quot; /&gt;<br>        &lt;/van-swipe-item&gt;<br>      &lt;/van-swipe&gt;<br>    &lt;/div&gt;<br><br>    &lt;!-- 轮播图下层部分 --&gt;<br>    &lt;div class=&quot;background&quot;&gt;<br>      &lt;van-swipe loop class=&quot;my-swipe-back&quot; :autoplay=&quot;3000&quot; :touchable=&quot;false&quot;&gt;<br>        &lt;van-swipe-item v-for=&quot;item in SwipeImages&quot; :key=&quot;item.index&quot;&gt;<br>          &lt;img :src=&quot;item.imgUrl&quot; /&gt;<br>        &lt;/van-swipe-item&gt;<br>      &lt;/van-swipe&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.swipe-container &#123;<br>  display: flex;<br>  align-items: center;<br>  justify-content: center;<br>  position: relative;<br>  overflow: hidden;<br>  border-radius: 20px 20px 20px 20px;<br>&#125;<br><br>.foreground &#123;<br>  z-index: 1;<br>&#125;<br><br>.my-swipe-fore &#123;<br>  border-radius: 20px 20px 20px 20px;<br>  height: 210px;<br>  width: 330px;<br>  margin: 20px 0px 20px 0px;<br>  box-shadow: 2px 2px 20px #3b2e32;<br>  border: transparent;<br>&#125;<br><br>.my-swipe-fore .van-swipe-item img &#123;<br>  width: 100%;<br>  height: 100%;<br>  border-radius: 20px 20px 20px 20px;<br>&#125;<br><br>.background &#123;<br>  z-index: 0;<br>  filter: blur(4px);<br>  opacity: 0.8;<br>  position: absolute;<br>&#125;<br><br>.my-swipe-back &#123;<br>  border-radius: 20px 20px 20px 20px;<br>  height: 240px;<br>  width: 365px;<br>&#125;<br><br>.my-swipe-back .van-swipe-item img &#123;<br>  width: 100%;<br>  height: 100%;<br>  border-radius: 20px 20px 20px 20px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页-小通知"><a href="#首页-小通知" class="headerlink" title="首页-小通知"></a>首页-小通知</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* components/HomeNoticeBar/index.vue */<br>&lt;script setup lang=&quot;ts&quot;&gt;<br>// 使用类型声明来定义 Props 类型<br>interface Props &#123;<br>  text?: string // 让 text 成为可选的<br>&#125;<br><br>// 使用 defineProps 来定义组件的 Props<br>defineProps&lt;Props&gt;()<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;van-notice-bar<br>    scrollable<br>    left-icon=&quot;volume-o&quot;<br>    color=&quot;#1989fa&quot;<br>    background=&quot;#ecf9ff&quot;<br>    :text=&quot;text || &#x27;暂时没有公告哦~&#x27;&quot;<br>  /&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页-队徽队名"><a href="#首页-队徽队名" class="headerlink" title="首页-队徽队名"></a>首页-队徽队名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* components/HomeTeamName/index.vue */<br>&lt;script setup lang=&quot;ts&quot;&gt;&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;TeamName&quot;&gt;<br>    &lt;img src=&quot;@/assets/images/透明队徽.png&quot; alt=&quot;&quot; /&gt;<br>    &lt;h3&gt;&quot;小红帽&quot;常青藤青年志愿者服务队&lt;/h3&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.TeamName &#123;<br>  display: flex;<br>  align-items: center;<br>  justify-content: center;<br>  margin: 5px 0;<br>&#125;<br><br>.TeamName img &#123;<br>  width: 30px;<br>  height: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页-宫格"><a href="#首页-宫格" class="headerlink" title="首页-宫格"></a>首页-宫格</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* components/HomeGrid/index.vue */<br>&lt;template&gt;<br>  &lt;van-grid icon-size=&quot;30px&quot; :column-num=&quot;2&quot; clickable&gt;<br>    &lt;van-grid-item<br>      text=&quot;校园服务通&quot;<br>      icon=&quot; icon-campus-service&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/campusservice&quot;<br>    /&gt;<br>    &lt;van-grid-item<br>      text=&quot;爱心雨伞&quot;<br>      icon=&quot; icon-love-umbrella&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/loveumbrella&quot;<br>    /&gt;<br>    &lt;van-grid-item<br>      text=&quot;服务队活动风采&quot;<br>      icon=&quot; icon-great-activities&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/activities&quot;<br>    /&gt;<br>    &lt;van-grid-item<br>      text=&quot;志愿活动报名&quot;<br>      icon=&quot; icon-signup-activities&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/signup&quot;<br>    /&gt;<br>    &lt;van-grid-item<br>      text=&quot;关于青队&quot;<br>      icon=&quot; icon-about-us&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/aboutus&quot;<br>    /&gt;<br>    &lt;van-grid-item<br>      text=&quot;用户意见反馈&quot;<br>      icon=&quot; icon-feedback&quot;<br>      icon-prefix=&quot;iconfont&quot;<br>      to=&quot;/feedback&quot;<br>    /&gt;<br>  &lt;/van-grid&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;&lt;/script&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="首页功能-用户问题反馈页面"><a href="#首页功能-用户问题反馈页面" class="headerlink" title="首页功能-用户问题反馈页面"></a>首页功能-用户问题反馈页面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>// 通知消息<br>const notification = ref&lt;string&gt;(<br>  &#x27;为了更好地提升我们的服务质量，我们诚挚邀请您提供宝贵的意见和建议&#x27;<br>)<br><br>// 表单数据<br>const isAnonymous = ref&lt;boolean&gt;(false) // 控制是否匿名<br>const username = ref&lt;string&gt;(&#x27;&#x27;)<br>const phone = ref&lt;string&gt;(&#x27;&#x27;)<br>const studentId = ref&lt;string&gt;(&#x27;&#x27;)<br>const message = ref&lt;string&gt;(&#x27;&#x27;)<br><br>// 验证规则<br>const rules = &#123;<br>  username: [<br>    &#123; required: !isAnonymous.value, message: &#x27;姓名不能为空&#x27;, trigger: &#x27;onBlur&#x27; &#125;<br>  ],<br>  phone: [<br>    &#123; required: false &#125;,<br>    &#123; pattern: /^1[3-9]\d&#123;9&#125;$/, message: &#x27;手机号格式错误&#x27;, trigger: &#x27;onBlur&#x27; &#125;<br>  ],<br>  studentId: [<br>    &#123;<br>      required: !isAnonymous.value,<br>      message: &#x27;学号不能为空&#x27;,<br>      trigger: &#x27;onBlur&#x27;<br>    &#125;,<br>    &#123; pattern: /^\d&#123;8,12&#125;$/, message: &#x27;学号格式不正确&#x27;, trigger: &#x27;onBlur&#x27; &#125; // 学号假设为8到12位数字<br>  ],<br>  message: [&#123; required: true, message: &#x27;反馈内容不能为空&#x27;, trigger: &#x27;onBlur&#x27; &#125;]<br>&#125;<br><br>// 提交处理<br>const onSubmit = () =&gt; &#123;<br>  // 提交表单逻辑<br>  if (isAnonymous.value) &#123;<br>    console.log(&#x27;匿名提交反馈&#x27;)<br>  &#125; else &#123;<br>    console.log(&#x27;实名提交反馈&#x27;)<br>  &#125;<br>  showToast(&#x27;提交成功&#x27;)<br>&#125;<br><br>// 监听匿名开关状态变化，实时更新验证规则<br>watch(isAnonymous, (newVal) =&gt; &#123;<br>  rules.username[0].required = !newVal<br>  rules.studentId[0].required = !newVal<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;!-- 小公告 --&gt;<br>    &lt;HomeNoticeBar :notification=&quot;notification&quot; /&gt;<br>    &lt;!-- 队徽队名 --&gt;<br>    &lt;HomeTeamName /&gt;<br><br>    &lt;van-form @submit=&quot;onSubmit&quot;&gt;<br>      &lt;van-cell-group inset&gt;<br>        &lt;!-- 姓名 --&gt;<br>        &lt;van-field<br>          v-model=&quot;username&quot;<br>          :rules=&quot;rules.username&quot;<br>          :required=&quot;rules.username[0].required&quot;<br>          label=&quot;姓名&quot;<br>          placeholder=&quot;请输入您的姓名&quot;<br>          v-if=&quot;!isAnonymous&quot;<br>        /&gt;<br><br>        &lt;!-- 学号 --&gt;<br>        &lt;van-field<br>          v-model=&quot;studentId&quot;<br>          :rules=&quot;rules.studentId&quot;<br>          :required=&quot;rules.studentId[0].required&quot;<br>          label=&quot;学号&quot;<br>          placeholder=&quot;请输入您的学号&quot;<br>          v-if=&quot;!isAnonymous&quot;<br>        /&gt;<br><br>        &lt;!-- 手机号 --&gt;<br>        &lt;van-field<br>          v-model=&quot;phone&quot;<br>          :rules=&quot;rules.phone&quot;<br>          :required=&quot;rules.phone[0].required&quot;<br>          label=&quot;手机号&quot;<br>          placeholder=&quot;请输入您的手机号&quot;<br>          v-if=&quot;!isAnonymous&quot;<br>        /&gt;<br><br>        &lt;!-- 反馈内容 --&gt;<br>        &lt;van-field<br>          v-model=&quot;message&quot;<br>          :rules=&quot;rules.message&quot;<br>          :required=&quot;rules.message[0].required&quot;<br>          rows=&quot;2&quot;<br>          autosize<br>          label=&quot;反馈内容&quot;<br>          type=&quot;textarea&quot;<br>          maxlength=&quot;1000&quot;<br>          placeholder=&quot;请输入反馈内容&quot;<br>          show-word-limit<br>        /&gt;<br><br>        &lt;van-field name=&quot;switch&quot; label=&quot;匿名提交&quot;&gt;<br>          &lt;template #input&gt;<br>            &lt;van-switch v-model=&quot;isAnonymous&quot; /&gt;<br>          &lt;/template&gt;<br>        &lt;/van-field&gt;<br>      &lt;/van-cell-group&gt;<br>      &lt;div style=&quot;margin: 16px&quot;&gt;<br>        &lt;van-button round block type=&quot;primary&quot; native-type=&quot;submit&quot;&gt;<br>          提交<br>        &lt;/van-button&gt;<br>      &lt;/div&gt;<br>    &lt;/van-form&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心"><a href="#个人中心" class="headerlink" title="个人中心"></a>个人中心</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import UserIsLoginView from &#x27;@/views/User/UserIsLogin/UserIsLoginView.vue&#x27;<br>import UserUnLoginView from &#x27;@/views/User/UserUnLogin/UserUnLoginView.vue&#x27;<br>// import&#123;isLogin&#125; from &#x27;@/utils/util&#x27;<br><br>let show = ref(false)<br><br>// onMounted(() =&gt; &#123;<br>//   if (isLogin()) &#123;<br>//     show.value = true<br>//   &#125; else &#123;<br>//     show.value = false<br>//   &#125;<br>// &#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;UserUnLoginView v-if=&quot;show&quot; /&gt;<br>    &lt;UserIsLoginView v-else /&gt;<br>    &lt;Divider dividerText=&quot;人工智能学院 “小红帽”常青藤青年志愿者服务队&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心-未登录"><a href="#个人中心-未登录" class="headerlink" title="个人中心-未登录"></a>个人中心-未登录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>const menuItems = [<br>  &#123;<br>    icon: &#x27; icon-personal-data&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;个人资料&#x27;,<br>    routerLink: &#x27;&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-permission-application&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;权限申请&#x27;,<br>    routerLink: &#x27;&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-operating-guide&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;使用指南&#x27;,<br>    routerLink: &#x27;/operatingguide&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-setting&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;设置&#x27;,<br>    routerLink: &#x27;&#x27;<br>  &#125;<br>]<br><br>const login = () =&gt; &#123;<br>  showToast(&#123;<br>    message: &#x27;正在开发中...&#x27;,<br>    position: &#x27;top&#x27;<br>  &#125;)<br>&#125;<br><br>const toastFn = () =&gt; &#123;<br>  showToast(&#123;<br>    message: &#x27;请登录之后再使用&#x27;,<br>    position: &#x27;top&#x27;<br>  &#125;)<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;container&quot;&gt;<br>    &lt;div class=&quot;defaultProfile&quot; @click=&quot;login&quot;&gt;<br>      &lt;div class=&quot;defaultAvatar&quot;&gt;<br>        &lt;van-icon<br>          name=&quot; icon-default-avatar&quot;<br>          class-prefix=&quot;iconfont&quot;<br>          size=&quot;80&quot;<br>        /&gt;<br>        &lt;div class=&quot;defaultText&quot;&gt;点击登录&lt;/div&gt;<br>      &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;div class=&quot;defaultSection&quot;&gt;<br>      &lt;ul&gt;<br>        &lt;li v-for=&quot;item in menuItems&quot; :key=&quot;item.text&quot; @click=&quot;toastFn()&quot;&gt;<br>          &lt;router-link :to=&quot;item.routerLink&quot; class=&quot;menuLink&quot;&gt;<br>            &lt;van-icon<br>              :name=&quot;item.icon&quot;<br>              :class-prefix=&quot;item.classPrefix&quot;<br>              style=&quot;margin: 0px 10px 0px 0px&quot;<br>            /&gt;<br>            &#123;&#123; item.text &#125;&#125;<br>          &lt;/router-link&gt;<br>        &lt;/li&gt;<br>      &lt;/ul&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.defaultProfile &#123;<br>  margin: 30px 0;<br>&#125;<br><br>.defaultProfile .defaultAvatar &#123;<br>  display: flex;<br>  flex-direction: column;<br>  align-items: center;<br>  justify-content: center;<br>&#125;<br><br>.defaultSection &#123;<br>  padding: 20px;<br>  background-color: #fff;<br>  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);<br>  display: flex;<br>  align-items: center;<br>  justify-content: center;<br>&#125;<br><br>.defaultSection ul &#123;<br>  list-style: none;<br>  width: 100%;<br>  padding: 0;<br>  margin: 0;<br>&#125;<br><br>.defaultSection li &#123;<br>  margin: 20px 0px 20px 0px;<br>&#125;<br><br>.menuLink &#123;<br>  display: block;<br>  padding: 10px;<br>  color: #333;<br>  text-decoration: none;<br>  border-radius: 5px;<br>  background-color: #f6f6f6;<br>  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);<br>  display: flex;<br>  align-items: center;<br>&#125;<br><br>.menuLink:hover &#123;<br>  background-color: #e6e6e6;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心-已登录"><a href="#个人中心-已登录" class="headerlink" title="个人中心-已登录"></a>个人中心-已登录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>const menuItems = [<br>  &#123;<br>    icon: &#x27; icon-personal-data&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;个人资料&#x27;,<br>    routerLink: &#x27;/personaldata&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-permission-application&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;权限申请&#x27;,<br>    routerLink: &#x27;/permissionapplication&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-operating-guide&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;使用指南&#x27;,<br>    routerLink: &#x27;/operatingguide&#x27;<br>  &#125;,<br>  &#123;<br>    icon: &#x27; icon-setting&#x27;,<br>    classPrefix: &#x27;iconfont&#x27;,<br>    text: &#x27;设置&#x27;,<br>    routerLink: &#x27;/setting&#x27;<br>  &#125;<br>]<br><br>// 用户名【应当通过企业微信登录之后来确定】<br>const username = &#x27;帅哥/美女&#x27;<br><br>// 设置问候语<br>const greeting = computed(() =&gt; &#123;<br>  const hour = new Date().getHours()<br>  if (hour &gt;= 6 &amp;&amp; hour &lt; 11) &#123;<br>    return `早上好, $&#123;username&#125;`<br>  &#125; else if (hour &gt;= 11 &amp;&amp; hour &lt; 13) &#123;<br>    return `中午好, $&#123;username&#125;`<br>  &#125; else if (hour &gt;= 13 &amp;&amp; hour &lt; 18) &#123;<br>    return `下午好, $&#123;username&#125;`<br>  &#125; else &#123;<br>    return `晚上好, $&#123;username&#125;`<br>  &#125;<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div class=&quot;container&quot;&gt;<br>    &lt;div class=&quot;defaultProfile&quot;&gt;<br>      &lt;div class=&quot;defaultAvatar&quot;&gt;<br>        &lt;van-icon<br>          name=&quot; icon-volunteer-avatar&quot;<br>          class-prefix=&quot;iconfont&quot;<br>          size=&quot;80&quot;<br>        /&gt;<br>        &lt;div class=&quot;defaultText&quot;&gt;&#123;&#123; greeting &#125;&#125;&lt;/div&gt;<br>      &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;div class=&quot;defaultSection&quot;&gt;<br>      &lt;ul&gt;<br>        &lt;li v-for=&quot;item in menuItems&quot; :key=&quot;item.text&quot;&gt;<br>          &lt;router-link :to=&quot;item.routerLink&quot; class=&quot;menuLink&quot;&gt;<br>            &lt;van-icon<br>              :name=&quot;item.icon&quot;<br>              :class-prefix=&quot;item.classPrefix&quot;<br>              style=&quot;margin: 0px 10px 0px 0px&quot;<br>            /&gt;<br>            &#123;&#123; item.text &#125;&#125;<br>          &lt;/router-link&gt;<br>        &lt;/li&gt;<br>      &lt;/ul&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.defaultProfile &#123;<br>  margin: 30px 0;<br>&#125;<br><br>.defaultProfile .defaultAvatar &#123;<br>  display: flex;<br>  flex-direction: column;<br>  align-items: center;<br>  justify-content: center;<br>&#125;<br><br>.defaultSection &#123;<br>  padding: 20px;<br>  background-color: #fff;<br>  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);<br>  display: flex;<br>  align-items: center;<br>  justify-content: center;<br>&#125;<br><br>.defaultSection ul &#123;<br>  list-style: none;<br>  width: 100%;<br>  padding: 0;<br>  margin: 0;<br>&#125;<br><br>.defaultSection li &#123;<br>  margin: 20px 0px 20px 0px;<br>&#125;<br><br>.menuLink &#123;<br>  display: block;<br>  padding: 10px;<br>  color: #333;<br>  text-decoration: none;<br>  border-radius: 5px;<br>  background-color: #f6f6f6;<br>  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);<br>  display: flex;<br>  align-items: center;<br>&#125;<br><br>.menuLink:hover &#123;<br>  background-color: #e6e6e6;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心功能-个人资料页面"><a href="#个人中心功能-个人资料页面" class="headerlink" title="个人中心功能-个人资料页面"></a>个人中心功能-个人资料页面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>// 用户的个人信息<br>const userInfo = ref(&#123;<br>  avatar: &#x27;&#x27;, // 用户头像<br>  username: &#x27;用户名&#x27;,<br>  realName: &#x27;张三&#x27;, // 真实姓名，不能修改<br>  studentId: &#x27;20230001&#x27;, // 学号，不能修改<br>  phone: &#x27;12345678901&#x27;,<br>  email: &#x27;example@example.com&#x27;,<br>  bio: &#x27;这是我的个人简介。&#x27;,<br>  gender: 0 // 性别：0 = 不填写，1 = 男，2 = 女<br>&#125;)<br><br>const isEditing = ref(false) // 标记是否处于编辑模式<br><br>// 进入编辑模式<br>const startEditing = () =&gt; &#123;<br>  isEditing.value = true<br>&#125;<br><br>// 提交修改<br>const saveChanges = () =&gt; &#123;<br>  isEditing.value = false<br>&#125;<br><br>// 上传头像<br>const uploadAvatar = (e: Event) =&gt; &#123;<br>  const file = (e.target as HTMLInputElement).files?.[0]<br>  if (file) &#123;<br>    userInfo.value.avatar = URL.createObjectURL(file)<br>    showToast(&#x27;头像上传成功&#x27;)<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;van-nav-bar title=&quot;个人资料&quot; fixed placeholder /&gt;<br><br>    &lt;!-- 头像部分 --&gt;<br>    &lt;div style=&quot;text-align: center; margin: 20px 0&quot;&gt;<br>      &lt;label for=&quot;avatar-upload&quot; style=&quot;cursor: pointer&quot;&gt;<br>        &lt;img<br>          :src=&quot;userInfo.avatar || &#x27;https://via.placeholder.com/80&#x27;&quot;<br>          alt=&quot;avatar&quot;<br>          style=&quot;width: 80px; height: 80px; border-radius: 50%&quot;<br>        /&gt;<br>      &lt;/label&gt;<br>      &lt;!-- 当处于编辑模式时才显示提示 --&gt;<br>      &lt;p v-if=&quot;isEditing&quot;&gt;点击头像修改&lt;/p&gt;<br>      &lt;input<br>        :disabled=&quot;!isEditing&quot;<br>        id=&quot;avatar-upload&quot;<br>        type=&quot;file&quot;<br>        accept=&quot;image/*&quot;<br>        style=&quot;display: none&quot;<br>        @change=&quot;uploadAvatar&quot;<br>      /&gt;<br>    &lt;/div&gt;<br><br>    &lt;!-- 个人信息部分 --&gt;<br>    &lt;van-cell-group&gt;<br>      &lt;!-- 用户名 --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.username&quot;<br>        label=&quot;用户名&quot;<br>        :disabled=&quot;!isEditing&quot;<br>        :input-align=&quot;&#x27;left&#x27;&quot;<br>      /&gt;<br><br>      &lt;!-- 真实姓名（不可修改） --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.realName&quot;<br>        label=&quot;真实姓名&quot;<br>        :disabled=&quot;true&quot;<br>        :input-align=&quot;&#x27;left&#x27;&quot;<br>        :class=&quot;isEditing ? &#x27;disabled-field&#x27; : &#x27;&#x27;&quot;<br>      /&gt;<br><br>      &lt;!-- 学号（不可修改） --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.studentId&quot;<br>        label=&quot;学号&quot;<br>        :disabled=&quot;true&quot;<br>        :input-align=&quot;&#x27;left&#x27;&quot;<br>        :class=&quot;isEditing ? &#x27;disabled-field&#x27; : &#x27;&#x27;&quot;<br>      /&gt;<br><br>      &lt;!-- 手机号 --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.phone&quot;<br>        label=&quot;手机号&quot;<br>        :disabled=&quot;!isEditing&quot;<br>        :input-align=&quot;&#x27;left&#x27;&quot;<br>      /&gt;<br><br>      &lt;!-- 邮箱 --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.email&quot;<br>        label=&quot;邮箱&quot;<br>        :disabled=&quot;!isEditing&quot;<br>        :input-align=&quot;&#x27;left&#x27;&quot;<br>      /&gt;<br><br>      &lt;!-- 性别 --&gt;<br>      &lt;van-field label=&quot;性别&quot; :disabled=&quot;!isEditing&quot; :input-align=&quot;&#x27;left&#x27;&quot;&gt;<br>        &lt;template #input&gt;<br>          &lt;van-radio-group<br>            :disabled=&quot;!isEditing&quot;<br>            v-model=&quot;userInfo.gender&quot;<br>            direction=&quot;horizontal&quot;<br>          &gt;<br>            &lt;van-radio name=&quot;1&quot;&gt;男&lt;/van-radio&gt;<br>            &lt;van-radio name=&quot;2&quot;&gt;女&lt;/van-radio&gt;<br>            &lt;van-radio name=&quot;0&quot;&gt;保密&lt;/van-radio&gt;<br>          &lt;/van-radio-group&gt;<br>        &lt;/template&gt;<br>      &lt;/van-field&gt;<br><br>      &lt;!-- 个人简介 --&gt;<br>      &lt;van-field<br>        v-model=&quot;userInfo.bio&quot;<br>        label=&quot;个人简介&quot;<br>        type=&quot;textarea&quot;<br>        rows=&quot;3&quot;<br>        :autosize=&quot;&#123; maxHeight: 100 &#125;&quot;<br>        maxlength=&quot;150&quot;<br>        placeholder=&quot;请输入个人简介&quot;<br>        show-word-limit<br>        :disabled=&quot;!isEditing&quot;<br>      /&gt;<br>    &lt;/van-cell-group&gt;<br><br>    &lt;!-- 编辑按钮 --&gt;<br>    &lt;div style=&quot;margin: 16px&quot;&gt;<br>      &lt;van-button v-if=&quot;!isEditing&quot; type=&quot;primary&quot; block @click=&quot;startEditing&quot;&gt;<br>        修改个人信息<br>      &lt;/van-button&gt;<br>      &lt;van-button v-else type=&quot;success&quot; block @click=&quot;saveChanges&quot;&gt;<br>        保存修改<br>      &lt;/van-button&gt;<br>    &lt;/div&gt;<br><br>    &lt;Divider dividerText=&quot;人工智能学院 “小红帽”常青藤青年志愿者服务队&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.disabled-field input &#123;<br>  background-color: #f5f5f5;<br>  color: #aaa;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心功能-权限申请页面"><a href="#个人中心功能-权限申请页面" class="headerlink" title="个人中心功能-权限申请页面"></a>个人中心功能-权限申请页面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>// 通知消息<br>const notification = ref&lt;string&gt;(<br>  &#x27;目前只支持青队成员可以申请权限哦~后续也会为普通用户提供权限福利！&#x27;<br>)<br><br>// 表单数据<br>const username = ref&lt;string&gt;(&#x27;&#x27;)<br>const studentId = ref&lt;string&gt;(&#x27;&#x27;)<br>const reson = ref&lt;string&gt;(&#x27;&#x27;)<br>const right = ref(&#x27;&#x27;)<br>const showPicker = ref(false)<br>const right_columns = [<br>  &#123; text: &#x27;超级管理员&#x27;, value: &#x27;1&#x27; &#125;,<br>  &#123; text: &#x27;管理员&#x27;, value: &#x27;2&#x27; &#125;<br>]<br><br>const onConfirm = (&#123; selectedOptions &#125;) =&gt; &#123;<br>  right.value = selectedOptions[0]?.text<br>  showPicker.value = false<br>&#125;<br><br>// 验证规则<br>const rules = &#123;<br>  username: [&#123; required: true, message: &#x27;姓名不能为空&#x27;, trigger: &#x27;onBlur&#x27; &#125;],<br>  studentId: [<br>    &#123;<br>      required: true,<br>      message: &#x27;学号不能为空&#x27;,<br>      trigger: &#x27;onBlur&#x27;<br>    &#125;,<br>    &#123; pattern: /^\d&#123;8,12&#125;$/, message: &#x27;学号格式不正确&#x27;, trigger: &#x27;onBlur&#x27; &#125; // 学号假设为8到12位数字<br>  ],<br>  right: [&#123; required: true, message: &#x27;请选择要申请的权限&#x27;, trigger: &#x27;onBlur&#x27; &#125;],<br>  reson: [&#123; required: true, message: &#x27;申请原因不能为空&#x27;, trigger: &#x27;onBlur&#x27; &#125;]<br>&#125;<br><br>// 提交处理<br>const onSubmit = () =&gt; &#123;<br>  showToast(&#x27;提交成功&#x27;)<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;!-- 小公告 --&gt;<br>    &lt;HomeNoticeBar :notification=&quot;notification&quot; /&gt;<br>    &lt;!-- 队徽队名 --&gt;<br>    &lt;HomeTeamName /&gt;<br><br>    &lt;van-form @submit=&quot;onSubmit&quot;&gt;<br>      &lt;van-cell-group inset&gt;<br>        &lt;!-- 姓名 --&gt;<br>        &lt;van-field<br>          v-model=&quot;username&quot;<br>          :rules=&quot;rules.username&quot;<br>          :required=&quot;rules.username[0].required&quot;<br>          label=&quot;姓名&quot;<br>          placeholder=&quot;请输入您的姓名&quot;<br>        /&gt;<br><br>        &lt;!-- 学号 --&gt;<br>        &lt;van-field<br>          v-model=&quot;studentId&quot;<br>          :rules=&quot;rules.studentId&quot;<br>          :required=&quot;rules.studentId[0].required&quot;<br>          label=&quot;学号&quot;<br>          placeholder=&quot;请输入您的学号&quot;<br>        /&gt;<br><br>        &lt;!-- 申请权限 --&gt;<br>        &lt;van-field<br>          v-model=&quot;right&quot;<br>          :rules=&quot;rules.right&quot;<br>          :required=&quot;rules.right[0].required&quot;<br>          is-link<br>          readonly<br>          name=&quot;picker&quot;<br>          label=&quot;选择器&quot;<br>          placeholder=&quot;点击选择权限&quot;<br>          @click=&quot;showPicker = true&quot;<br>        /&gt;<br>        &lt;van-popup v-model:show=&quot;showPicker&quot; position=&quot;top&quot;&gt;<br>          &lt;van-picker<br>            :columns=&quot;right_columns&quot;<br>            @confirm=&quot;onConfirm&quot;<br>            @cancel=&quot;showPicker = false&quot;<br>          /&gt;<br>        &lt;/van-popup&gt;<br><br>        &lt;!-- 申请原因 --&gt;<br>        &lt;van-field<br>          v-model=&quot;reson&quot;<br>          :rules=&quot;rules.reson&quot;<br>          :required=&quot;rules.reson[0].required&quot;<br>          rows=&quot;2&quot;<br>          autosize<br>          label=&quot;申请原因&quot;<br>          type=&quot;textarea&quot;<br>          maxlength=&quot;1000&quot;<br>          placeholder=&quot;请输入申请原因&quot;<br>          show-word-limit<br>        /&gt;<br>      &lt;/van-cell-group&gt;<br>      &lt;div style=&quot;margin: 16px&quot;&gt;<br>        &lt;van-button round block type=&quot;primary&quot; native-type=&quot;submit&quot;&gt;<br>          提交<br>        &lt;/van-button&gt;<br>      &lt;/div&gt;<br>    &lt;/van-form&gt;<br>    &lt;Divider dividerText=&quot;人工智能学院 “小红帽”常青藤青年志愿者服务队&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心功能-使用指南页面"><a href="#个人中心功能-使用指南页面" class="headerlink" title="个人中心功能-使用指南页面"></a>个人中心功能-使用指南页面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>const activeName = ref&lt;string&gt;(&#x27;1&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;van-nav-bar title=&quot;使用指南&quot; fixed placeholder /&gt;<br>    &lt;van-collapse v-model=&quot;activeName&quot; accordion&gt;<br>      &lt;!-- 登录账户指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;步骤 1: 登录账户&quot;<br>        name=&quot;1&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;1&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        使用注册时的手机号或邮箱进行登录，未注册用户请先注册。登录后可以访问所有功能。<br>      &lt;/van-collapse-item&gt;<br><br>      &lt;!-- 查看通知指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;步骤 2: 查看通知&quot;<br>        name=&quot;2&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;2&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        登录后可以在通知页面查看最新的公告和通知，保持信息的及时获取。<br>      &lt;/van-collapse-item&gt;<br><br>      &lt;!-- 提交反馈指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;步骤 3: 提交反馈&quot;<br>        name=&quot;3&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;3&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        在反馈页面填写您的意见和建议，支持匿名提交，帮助我们改进服务。<br>      &lt;/van-collapse-item&gt;<br><br>      &lt;!-- 修改个人信息指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;步骤 4: 修改个人信息&quot;<br>        name=&quot;4&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;4&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        您可以在个人中心修改头像、昵称和联系方式等信息，以确保个人资料的准确性。<br>      &lt;/van-collapse-item&gt;<br><br>      &lt;!-- 常见问题指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;常见问题&quot;<br>        name=&quot;5&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;5&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        在常见问题页面，我们整理了一些常见的使用疑问及解答，供您参考。<br>      &lt;/van-collapse-item&gt;<br><br>      &lt;!-- 联系客服指南 --&gt;<br>      &lt;van-collapse-item<br>        title=&quot;联系客服&quot;<br>        name=&quot;6&quot;<br>        :title-style=&quot;&#123; color: activeName === &#x27;6&#x27; ? &#x27;#1989fa&#x27; : &#x27;#000&#x27; &#125;&quot;<br>      &gt;<br>        如果遇到问题无法解决，您可以通过联系客服功能与我们取得联系。<br>      &lt;/van-collapse-item&gt;<br>    &lt;/van-collapse&gt;<br>    &lt;Divider dividerText=&quot;人工智能学院 “小红帽”常青藤青年志愿者服务队&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="个人中心功能-设置页面"><a href="#个人中心功能-设置页面" class="headerlink" title="个人中心功能-设置页面"></a>个人中心功能-设置页面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>const router = useRouter()<br>// 退出登录函数<br>const logout = () =&gt; &#123;<br>  // 模拟退出登录逻辑，可以在这里处理实际的退出登录操作<br>  showSuccessToast(&#123;<br>    message: &#x27;已退出登录&#x27;,<br>    position: &#x27;top&#x27;<br>  &#125;)<br>  router.push(&#x27;/&#x27;)<br>&#125;<br><br>// 处理其他设置项点击事件<br>const handleSettingClick = (message: string) =&gt; &#123;<br>  showToast(&#123;<br>    message: message,<br>    position: &#x27;top&#x27;<br>  &#125;)<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;van-nav-bar title=&quot;设置&quot; fixed placeholder /&gt;<br>    &lt;!-- 设置选项 --&gt;<br>    &lt;van-cell-group&gt;<br>      &lt;!-- 修改密码 --&gt;<br>      &lt;van-cell<br>        title=&quot;修改密码&quot;<br>        is-link<br>        @click=&quot;handleSettingClick(&#x27;修改密码功能正在开发中...&#x27;)&quot;<br>      /&gt;<br><br>      &lt;!-- 通知设置 --&gt;<br>      &lt;van-cell<br>        title=&quot;通知设置&quot;<br>        is-link<br>        @click=&quot;handleSettingClick(&#x27;通知设置功能正在开发中...&#x27;)&quot;<br>      /&gt;<br><br>      &lt;!-- 隐私设置 --&gt;<br>      &lt;van-cell<br>        title=&quot;隐私设置&quot;<br>        is-link<br>        @click=&quot;handleSettingClick(&#x27;隐私设置功能正在开发中...&#x27;)&quot;<br>      /&gt;<br>    &lt;/van-cell-group&gt;<br><br>    &lt;!-- 退出登录按钮 --&gt;<br>    &lt;div style=&quot;margin: 16px&quot;&gt;<br>      &lt;van-button type=&quot;danger&quot; block @click=&quot;logout&quot;&gt; 退出登录 &lt;/van-button&gt;<br>    &lt;/div&gt;<br><br>    &lt;Divider dividerText=&quot;人工智能学院 “小红帽”常青藤青年志愿者服务队&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="组件-底线"><a href="#组件-底线" class="headerlink" title="组件-底线"></a>组件-底线</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* components/Divider/index.vue */<br>&lt;script setup lang=&quot;ts&quot;&gt;<br>// 使用类型声明来定义 Props 类型<br>interface Props &#123;<br>  dividerText?: string // 让 dividerText 成为可选的<br>&#125;<br><br>// 使用 defineProps 来定义组件的 Props<br>defineProps&lt;Props&gt;()<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;van-divider class=&quot;divider&quot;&gt;<br>    &#123;&#123; dividerText &#125;&#125;<br>  &lt;/van-divider&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.divider &#123;<br>  margin: 20px 0px 20px 0px;<br>  padding: 0px 10px 0px 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h2 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h2><ol><li><strong>controllers 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放业务逻辑处理函数。每个控制器负责处理特定路由的请求，调用相应的 <code>service</code> 来执行操作，然后将响应返回给客户端。</li><li><strong>添加内容</strong>：为每个实体或模块创建一个控制器文件，包含增、删、改、查等操作。例如：<code>userController.ts</code> 处理用户相关的请求。</li></ul><ol start="2"><li><strong>db 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放数据库连接配置和数据库操作相关的代码。你可以在这里创建数据库连接池和处理数据库查询。</li><li><strong>添加内容</strong>：创建 <code>index.ts</code> 文件，用来管理数据库连接（如 MySQL）。还可以根据需求创建数据库查询方法。</li></ul><ol start="3"><li><strong>middlewares 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放中间件，用于处理路由请求前的一些公共操作，如验证、日志、错误处理等。</li><li><strong>添加内容</strong>：添加常见的中间件文件，如 <code>authMiddleware.ts</code>（用于认证）和 <code>errorMiddleware.ts</code>（用于统一错误处理）。</li></ul><ol start="4"><li><strong>routers 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放路由定义，指定哪些 URL 对应哪些控制器的操作。</li><li><strong>添加内容</strong>：为每个模块创建一个路由文件，例如 <code>userRouter.ts</code>。使用 <code>express.Router()</code> 来定义路由，并导入相应的控制器方法。</li></ul><ol start="5"><li><strong>services 文件夹</strong></li></ol><ul><li><strong>作用</strong>：负责处理业务逻辑和数据操作，主要与 <code>db</code> 层进行交互。<code>service</code> 层让控制器和数据库逻辑分离，使得代码结构更加清晰。</li><li><strong>添加内容</strong>：为每个实体创建服务文件，例如 <code>userService.ts</code>，负责用户的增删改查逻辑。</li></ul><ol start="6"><li><strong>types 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放 TypeScript 类型定义。你可以在这里定义全局的接口、类型等。</li><li><strong>添加内容</strong>：例如 <code>user.d.ts</code> 用于定义用户实体的类型，或者定义 <code>responseFormat.ts</code> 用于标准化 API 响应结构的类型。</li></ul><ol start="7"><li><strong>utils 文件夹</strong></li></ol><ul><li><strong>作用</strong>：存放通用的工具函数或辅助功能，例如加密函数、格式化工具、日志工具等。</li><li><strong>添加内容</strong>：比如创建一个 <code>responseHandler.ts</code>，封装和优化 <code>res.send()</code> 的响应格式，使其可以统一处理成功或失败的请求。</li></ul><h3 id="创建后端项目"><a href="#创建后端项目" class="headerlink" title="创建后端项目"></a>创建后端项目</h3><p><strong>初始化npm项目</strong></p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> init -y<br></code></pre></td></tr></table></figure><p> <strong>安装express框架</strong></p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> i express<br></code></pre></td></tr></table></figure><p><strong>安装依赖与ts有关的依赖</strong>：<code>express</code>是基于<code>node</code>环境的，所以我们需要安装两个类型依赖，以获得相关<code>api</code>的类型提示</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">npm install typescript ts-<span class="hljs-keyword">node</span> <span class="hljs-title">@types</span>/<span class="hljs-keyword">node</span> <span class="hljs-title">@types</span>/express --save-dev<br></code></pre></td></tr></table></figure><p><strong>初始化 TypeScript 配置</strong>：执行以下命令来生成 <code>tsconfig.json</code> 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tsc --init<br></code></pre></td></tr></table></figure><p><code>tsconfig.json</code> 文件中的配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;es2016&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;commonjs&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;esModuleInterop&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;skipLibCheck&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;rootDir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./src&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outDir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;src/**/*&quot;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;exclude&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;node_modules&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="项目入口文件"><a href="#项目入口文件" class="headerlink" title="项目入口文件"></a>项目入口文件</h3><p><strong>创建项目入口文件</strong>：在 <code>src</code> 目录下创建 <code>app.ts</code> 文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 express 模块</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-comment">// 创建 express 的服务器实例</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br><span class="hljs-comment">// write your code here...</span><br><br><span class="hljs-comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3007</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;api server running at http://127.0.0.1:3007&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="配置-cors-跨域"><a href="#配置-cors-跨域" class="headerlink" title="配置 cors 跨域"></a>配置 cors 跨域</h3><p>安装cors中间件</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> i cors<br></code></pre></td></tr></table></figure><p>在app.js中配置cors中间件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入 cors 中间件</span><br><span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>)<br><span class="hljs-comment">// 将 cors 注册为全局中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())<br></code></pre></td></tr></table></figure><h3 id="配置解析表单数据的中间件"><a href="#配置解析表单数据的中间件" class="headerlink" title="配置解析表单数据的中间件"></a>配置解析表单数据的中间件</h3><p>配置解析 JSON 和 application&#x2F;x-www-form-urlencoded 格式的表单数据的中间件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 配置解析表单数据的中间件</span><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;))<br></code></pre></td></tr></table></figure><h3 id="配置路由-1"><a href="#配置路由-1" class="headerlink" title="配置路由"></a>配置路由</h3><p>创建routers、controllers、services三大文件夹</p><ul><li>routers：<code>index.ts</code>文件统一管理所有模块的路由；其他均为模块单独的路由管理</li><li>controllers：每个模块的管理端代码，放置请求的整体代码</li><li>services：每个模块的服务端代码，放置具体的请求内容和实现逻辑</li></ul><h3 id="封装统一的响应格式"><a href="#封装统一的响应格式" class="headerlink" title="封装统一的响应格式"></a>封装统一的响应格式</h3><p>新建<code>/utils/responseUtil.ts</code>文件，在此封装统一响应格式：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// 封装统一的响应格式</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Response</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResponseFormat</span> &#123;<br>  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;<br>  data?: <span class="hljs-built_in">any</span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">successResponse</span> = (<span class="hljs-params"><span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>, message = <span class="hljs-string">&#x27;Success&#x27;</span>, statusCode = <span class="hljs-number">200</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">response</span>: <span class="hljs-title class_">ResponseFormat</span> = &#123;<br>    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,<br>    message,<br>    data<br>  &#125;;<br>  res.<span class="hljs-title function_">status</span>(statusCode).<span class="hljs-title function_">json</span>(response);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">errorResponse</span> = (<span class="hljs-params"><span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>, statusCode = <span class="hljs-number">500</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">response</span>: <span class="hljs-title class_">ResponseFormat</span> = &#123;<br>    <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,<br>    message<br>  &#125;;<br>  res.<span class="hljs-title function_">status</span>(statusCode).<span class="hljs-title function_">json</span>(response);<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="安装并配置-mysql-模块"><a href="#安装并配置-mysql-模块" class="headerlink" title="安装并配置 mysql 模块"></a>安装并配置 mysql 模块</h3><p>运行如下命令，安装 <code>mysql</code> 模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i mysql<br>npm install @types/mysql --save-dev<br></code></pre></td></tr></table></figure><p>新建 <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> mysql <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mysql&#x27;</span>;<br><br><span class="hljs-keyword">const</span> db = mysql.<span class="hljs-title function_">createPool</span>(&#123;<br>  <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>  <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;Hu1282861514&#x27;</span>,<br>  <span class="hljs-attr">database</span>: <span class="hljs-string">&#x27;cqt_cloud_platform&#x27;</span><br>&#125;);<br><br><span class="hljs-comment">// 封装 db.query 为 Promise</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> query = &lt;T&gt;(<span class="hljs-attr">sql</span>: string, values?: any): <span class="hljs-title class_">Promise</span>&lt;T&gt; =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    db.<span class="hljs-title function_">query</span>(sql, values, <span class="hljs-function">(<span class="hljs-params">error, results</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (error) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(error);<br>      &#125;<br>      <span class="hljs-title function_">resolve</span>(results);<br>    &#125;);<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> db;<br></code></pre></td></tr></table></figure><h3 id="配置中间件"><a href="#配置中间件" class="headerlink" title="配置中间件"></a>配置中间件</h3><p>创建<code>middlewares</code>文件夹，放置使用的中间件</p><p><strong>表单验证中间件</strong>（<code>validateInput.ts</code>）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Request</span>, <span class="hljs-title class_">Response</span>, <span class="hljs-title class_">NextFunction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;<br><br><span class="hljs-keyword">const</span> studentIdRegex = <span class="hljs-regexp">/^\d&#123;10&#125;$/</span>; <span class="hljs-comment">// 正则表达式用于验证学号</span><br><span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[a-zA-Z0-9._%+-]+@ctbu\.edu\.cn$/</span>; <span class="hljs-comment">// 正则表达式用于验证邮箱</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> validateRegistration = (<span class="hljs-attr">req</span>: <span class="hljs-title class_">Request</span>, <span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">NextFunction</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; student_id, email, password &#125; = req.<span class="hljs-property">body</span>;<br><br>  <span class="hljs-keyword">if</span> (!student_id || !studentIdRegex.<span class="hljs-title function_">test</span>(student_id)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;学号必须为10位数字&#x27;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (!email || !email.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;@ctbu.edu.cn&#x27;</span>)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;邮箱必须以 @ctbu.edu.cn 结尾&#x27;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (!password || password.<span class="hljs-property">length</span> &lt; <span class="hljs-number">6</span> || !<span class="hljs-regexp">/[A-Z]/</span>.<span class="hljs-title function_">test</span>(password) || !<span class="hljs-regexp">/[a-z]/</span>.<span class="hljs-title function_">test</span>(password) || !<span class="hljs-regexp">/\d/</span>.<span class="hljs-title function_">test</span>(password)) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;密码长度至少为6位，并且包含大小写字母和数字&#x27;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 如果验证通过，调用 next()</span><br>  <span class="hljs-title function_">next</span>();<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> validateLogin = (<span class="hljs-attr">req</span>: <span class="hljs-title class_">Request</span>, <span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">NextFunction</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; loginInput, password &#125; = req.<span class="hljs-property">body</span>;<br><br>  <span class="hljs-comment">// 检查是否输入了学号或邮箱</span><br>  <span class="hljs-keyword">if</span> (!loginInput || (!studentIdRegex.<span class="hljs-title function_">test</span>(loginInput) &amp;&amp; !emailRegex.<span class="hljs-title function_">test</span>(loginInput))) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;学号或邮箱格式错误&#x27;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 检查是否输入了密码</span><br>  <span class="hljs-keyword">if</span> (!password) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;密码不能为空&#x27;</span> &#125;);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 如果验证通过，调用 next()</span><br>  <span class="hljs-title function_">next</span>();<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="安装密码加密库-bcrypt-和-JWT-库"><a href="#安装密码加密库-bcrypt-和-JWT-库" class="headerlink" title="安装密码加密库 (bcrypt) 和 JWT 库"></a><strong>安装密码加密库 (<code>bcrypt</code>) 和 JWT 库</strong></h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> install bcrypt jsonwebtoken<br><span class="hljs-built_in">npm</span> install @types/bcrypt --save-dev<br><span class="hljs-built_in">npm</span> install @types/jsonwebtoken --save-dev<br></code></pre></td></tr></table></figure><ul><li><code>bcrypt</code>: 用于密码哈希和验证。</li><li><code>jsonwebtoken</code>: 用于生成和验证 JWT。</li><li><code>@types/bcrypt</code>: bcrypt 的 TypeScript 类型定义。</li><li><code>@types/jsonwebtoken</code>: JWT 的 TypeScript 类型定义。</li></ul><h3 id="用户注册逻辑"><a href="#用户注册逻辑" class="headerlink" title="用户注册逻辑"></a>用户注册逻辑</h3><h2 id="注意事项及问题解决"><a href="#注意事项及问题解决" class="headerlink" title="注意事项及问题解决"></a>注意事项及问题解决</h2><h3 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h3><p><strong>本项目开发建议使用下方的开发软件，请提前配置好下方所示的开发环境</strong></p><p>开发软件：VS Code，微信开发者工具</p><p>开发环境依赖：</p><ul><li>node：18.17.0</li><li>npm：10.8.2</li><li>pnpm：9.1.0</li><li>ts-node：10.9.2</li><li>nodemon：3.1.0</li></ul><h3 id="导入vue文件TS报错"><a href="#导入vue文件TS报错" class="headerlink" title="导入vue文件TS报错"></a>导入vue文件TS报错</h3><p>错误信息提示： TypeScript 无法找到模块 <code>@/views/**/**.vue</code> 的声明文件，这意味着 TypeScript 无法推断该文件的类型，因此默认将其视为 <code>any</code> 类型。</p><p>原因：TypeScript 默认不支持 .vue 文件的模块类型解析，需要手动添加类型声明文件。</p><p>解决方法：</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">/* env.d.ts */</span><br><span class="hljs-comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;*.vue&#x27;</span> &#123;<br>  <span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">DefineComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br>  <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">DefineComponent</span>&lt;&#123;&#125;, &#123;&#125;, <span class="hljs-built_in">any</span>&gt;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>暑假学习</title>
    <link href="/2024/08/02/%E6%9A%91%E5%81%87%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/08/02/%E6%9A%91%E5%81%87%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h1><p><strong>JS已有的类型</strong></p><p>原始类型：number&#x2F;string&#x2F;boolean&#x2F;null&#x2F;undefined&#x2F;symbol</p><p>对象类型：object（数组、对象、函数等对象）</p><p><strong>TS新增的类型</strong></p><p>联合类型、自定义类型（类型别名）、接口、元祖、字面量类型、枚举、void、any等</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// 原始类型</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">18</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">myName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">&#x27;eee&#x27;</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">isLoading</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">s</span>: <span class="hljs-built_in">symbol</span> = <span class="hljs-title class_">Symbol</span>()<br><br><span class="hljs-comment">// 对象类型</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">numbers</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br><span class="hljs-keyword">let</span> <span class="hljs-attr">strings</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>]<br><span class="hljs-keyword">let</span> <span class="hljs-attr">strings</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>]<br><br><span class="hljs-comment">// 联合类型</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: (<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>)[] = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-number">3</span>]<br><br><span class="hljs-comment">// 类型别名</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">CustomArray</span> = (<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>)[]<br><span class="hljs-keyword">let</span> <span class="hljs-attr">arr1</span>: <span class="hljs-title class_">CustomArray</span> = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-number">3</span>]<br><br><span class="hljs-comment">// 函数类型</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">num2</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> num1 + num2<br>&#125;<br><span class="hljs-keyword">const</span> add = (<span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">num2</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> num1 + num2<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">num2</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> = <span class="hljs-function">(<span class="hljs-params">num1, num2</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> num1 + num2<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>, name)<br>&#125;<br><br><span class="hljs-comment">// 可选参数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">mySlice</span>(<span class="hljs-params">start?: <span class="hljs-built_in">number</span>, end?: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;起始索引：&#x27;</span>, start, <span class="hljs-string">&#x27;结束索引：&#x27;</span>, end)<br>&#125;<br><br><span class="hljs-comment">// 对象类型</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">person</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; &#125;<br><br><span class="hljs-comment">// 接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPerson</span> &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span><br><span class="hljs-title function_">sayHi</span>(): <span class="hljs-built_in">void</span><br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">IPerson</span> = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">19</span>,<br>    <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"></span>) &#123;&#125;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">接口与类型别名的对比：</span><br><span class="hljs-comment">相同点：都可以给对象指定类型</span><br><span class="hljs-comment">不同点：接口只能为对象指定类型；类型别名不仅可以为对象指定类型，实际上可以为任意类型指定别名</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">IPerson</span> = &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span><br><span class="hljs-title function_">sayHi</span>(): <span class="hljs-built_in">void</span><br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NumStr</span> =  <span class="hljs-built_in">number</span> |<span class="hljs-built_in">string</span><br><br><span class="hljs-comment">// 接口的继承</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Point2D</span> &#123; <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> &#125;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Point3D</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Point2D</span> &#123; <span class="hljs-attr">z</span>: <span class="hljs-built_in">number</span> &#125;<br><br><span class="hljs-comment">// 元组</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">position</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-number">0.11</span>, <span class="hljs-number">0.22</span>]<br><br><span class="hljs-comment">// 类型断言</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">aLink</span>: <span class="hljs-title class_">HTMLAnchorElement</span><br><span class="hljs-keyword">const</span> aLink = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementByID</span>(<span class="hljs-string">&#x27;link&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLAnchorElement</span><br><span class="hljs-comment">// const aLink = &lt;HTMLAnchorElement&gt;document.getELementById(&#x27;link&#x27;)【不常用，跟react有冲突】</span><br><br><span class="hljs-comment">// 字面量类型</span><br><span class="hljs-keyword">let</span> str1 = <span class="hljs-string">&#x27;Hello TS&#x27;</span> <span class="hljs-comment">// string；let声明变量</span><br><span class="hljs-keyword">const</span> str2 = <span class="hljs-string">&#x27;Hello TS&#x27;</span> <span class="hljs-comment">// &quot;Hello TS&quot;；const声明常量</span><br><span class="hljs-comment">// 用来表示一组明确的可选值列表</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">changeDirection</span>(<span class="hljs-params"><span class="hljs-attr">directin</span>: <span class="hljs-string">&#x27;up&#x27;</span> | <span class="hljs-string">&#x27;down&#x27;</span> | <span class="hljs-string">&#x27;left&#x27;</span> | <span class="hljs-string">&#x27;right&#x27;</span></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(direction)<br>&#125;<br><br><span class="hljs-comment">// 枚举(enum)</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Direction</span> &#123; <span class="hljs-title class_">Up</span>, <span class="hljs-title class_">Down</span>, <span class="hljs-title class_">Left</span>, <span class="hljs-title class_">Right</span> &#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">changeDirection</span>(<span class="hljs-params"><span class="hljs-attr">directin</span>: <span class="hljs-title class_">Direction</span></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(direction)<br>&#125;<br><span class="hljs-title function_">changeDirection</span>(<span class="hljs-title class_">Direction</span>.<span class="hljs-property">Left</span>)<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">枚举成员的值默认第一个为0依次增加，也可以自定义值【默认数字，也可以为字符串】</span><br><span class="hljs-comment">enum Direction &#123; Up = 10, Down, Left, Right &#125;</span><br><span class="hljs-comment">enum Direction &#123; Up = 2, Down = 4, Left = 8, Right = 16 &#125;</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">// 字符串枚举</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Direction</span> &#123; <br>    <span class="hljs-title class_">Up</span> = <span class="hljs-string">&#x27;UP&#x27;</span>,<br>    <span class="hljs-title class_">Down</span> = <span class="hljs-string">&#x27;DOWN&#x27;</span>,<br>    <span class="hljs-title class_">Left</span> = <span class="hljs-string">&#x27;LEFT&#x27;</span>,<br>    <span class="hljs-title class_">Right</span> = <span class="hljs-string">&#x27;RIGHT&#x27;</span> <br>&#125;<br><br><span class="hljs-comment">// any类型</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-built_in">any</span> = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span> &#125;<br><br><span class="hljs-comment">// typeof</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-string">&quot;Hello world&quot;</span>)<br><span class="hljs-comment">// 根据类型上下文来</span><br><span class="hljs-keyword">let</span> p = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> &#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">formatPoint</span>(<span class="hljs-params"><span class="hljs-attr">point</span>: &#123; x: <span class="hljs-built_in">number</span>; y: <span class="hljs-built_in">number</span>&#125;</span>)&#123;&#125;<br><span class="hljs-title function_">formatPoint</span>(p)<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">formatPoint</span>(<span class="hljs-params"><span class="hljs-attr">point</span>: <span class="hljs-keyword">typeof</span> p</span>)<br></code></pre></td></tr></table></figure><p><strong>TS高级类型</strong></p><p>class类、类型兼容性、交叉类型、泛型和keyof、索引签名类型和索引查询类型、映射类型等</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// class类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span><br>    <span class="hljs-comment">// gender: &#x27;男&#x27;</span><br>    <span class="hljs-attr">gender</span>: <span class="hljs-built_in">string</span><br>    x = <span class="hljs-number">10</span><br>    y = <span class="hljs-number">10</span><br>    <br>    <span class="hljs-comment">// 构造函数</span><br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">gender</span>: <span class="hljs-built_in">string</span></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">gender</span> = gender<br>    &#125;<br>    <br>    <span class="hljs-comment">// 实例方法</span><br>    <span class="hljs-title function_">scale</span>(<span class="hljs-attr">n</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> *= n<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> *= n<br>    &#125;<br>&#125;<br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br>p.<span class="hljs-property">age</span><br><br><span class="hljs-comment">// 类继承</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>    <span class="hljs-title function_">move</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Moving along!&#x27;</span>) &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>    <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;wang!&#x27;</span>) &#125;<br>&#125;<br><span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>()<br><br><span class="hljs-comment">// 接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Singable</span> &#123;<br>    <span class="hljs-title function_">sing</span>(): <span class="hljs-built_in">void</span><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Singable</span> &#123;<br>    <span class="hljs-title function_">sing</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;asdfadf&#x27;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 修饰符</span><br><span class="hljs-keyword">public</span><br><span class="hljs-keyword">protected</span><br><span class="hljs-keyword">private</span><br><span class="hljs-keyword">readonly</span>：表示只读，只能被构造函数进行赋值<br><br><span class="hljs-comment">// 类型兼容性</span><br>对象兼容：成员多的赋值给成员少的<br>接口兼容：多的赋值给少的<br>函数兼容：参数个数少的赋值给参数个数多的；参数类型对应一致；返回值多的赋值给少的<br><br><span class="hljs-comment">// 交叉类型（&amp;）</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> &#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> &#125;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Contact</span> &#123; <span class="hljs-attr">phone</span>: <span class="hljs-built_in">string</span> &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PersonDetail</span> = <span class="hljs-title class_">Person</span> &amp; <span class="hljs-title class_">Contact</span><br><span class="hljs-keyword">let</span> obj = <span class="hljs-title class_">PersonDetail</span> = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>,<br>    <span class="hljs-attr">phone</span>: <span class="hljs-string">&#x27;123...&#x27;</span><br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">交叉类型和接口继承的对比</span><br><span class="hljs-comment">相同点：都可以实现对象类型的组合</span><br><span class="hljs-comment">不同点：两种方式实现类型组合时，对于同名属性之间，处理类型冲突的方式不同。继承会报错但是交叉类型不会</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">interface A &#123;</span><br><span class="hljs-comment">fn: (value: number) =&gt; string</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">interface B extends A &#123;</span><br><span class="hljs-comment">fn: (value: string) =&gt; string</span><br><span class="hljs-comment">&#125;这里是错误的</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">interface A &#123;</span><br><span class="hljs-comment">fn: (value: number) =&gt; string</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">interface B &#123;</span><br><span class="hljs-comment">fn: (value: string) =&gt; string</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">type C = A &amp; B 相当于 在C中fn: (value: string | number) =&gt; string</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">// 泛型</span><br><span class="hljs-keyword">function</span> id&lt;<span class="hljs-title class_">Type</span>&gt;(<span class="hljs-attr">value</span>: <span class="hljs-title class_">Type</span>): <span class="hljs-title class_">Type</span> &#123; <span class="hljs-keyword">return</span> value &#125;<br><span class="hljs-keyword">const</span> num = id&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">10</span>) <span class="hljs-comment">// 此时num的类型即为number</span><br><span class="hljs-keyword">const</span> str = id&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;str&#x27;</span>) <span class="hljs-comment">// 此时str的类型即为string</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-title function_">id</span>(<span class="hljs-number">10</span>) <span class="hljs-comment">// 可以简化不用写&lt;&gt;，会推断为字面量类型</span><br><br><span class="hljs-comment">// 泛型约束</span><br><span class="hljs-comment">/*指定更加具体的类型*/</span><br><span class="hljs-keyword">function</span> id&lt;<span class="hljs-title class_">Type</span>&gt;(<span class="hljs-attr">value</span>: <span class="hljs-title class_">Type</span>[]): <span class="hljs-title class_">Type</span>[] &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-property">length</span>)<br>    <span class="hljs-keyword">return</span> value<br>&#125;<br><span class="hljs-comment">/*添加约束*/</span><br><span class="hljs-comment">/*只要有length属性就可以*/</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILength</span> &#123; <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> &#125;<br><span class="hljs-keyword">function</span> id&lt;<span class="hljs-title class_">Type</span> extedns <span class="hljs-title class_">ILength</span>&gt;(<span class="hljs-attr">value</span>: <span class="hljs-title class_">Type</span>): <span class="hljs-title class_">Type</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-property">length</span>)<br>    <span class="hljs-keyword">return</span> value<br>&#125;<br><br><span class="hljs-comment">// 多个泛型变量的情况</span><br><span class="hljs-keyword">function</span> getProp&lt;<span class="hljs-title class_">Type</span>, <span class="hljs-title class_">Key</span> <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">Type</span>&gt;(<span class="hljs-attr">obj</span>: <span class="hljs-title class_">Type</span>, <span class="hljs-attr">key</span>: <span class="hljs-title class_">Key</span>)&#123;<br>    <span class="hljs-keyword">return</span> obj[key]<br>&#125;<br><span class="hljs-keyword">let</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;<br><span class="hljs-title function_">getProp</span>(person, <span class="hljs-string">&#x27;name&#x27;</span>)<br><br><span class="hljs-comment">// 泛型接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IdFunc</span>&lt;<span class="hljs-title class_">Type</span>&gt; &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-title class_">Type</span></span>) =&gt;</span> <span class="hljs-title class_">Type</span><br>    <span class="hljs-attr">ids</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Type</span>[]<br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">IdFunc</span>&lt;<span class="hljs-built_in">number</span>&gt; &#123;<br>    <span class="hljs-title function_">id</span>(<span class="hljs-params">value</span>) &#123; <span class="hljs-keyword">return</span> value &#125;,<br>    <span class="hljs-title function_">ids</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>] &#125;<br>&#125;<br><br><span class="hljs-comment">// 泛型类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-title class_">NumType</span>&gt; &#123;<br>    <span class="hljs-attr">defaultValue</span>: <span class="hljs-title class_">NumType</span><br>    <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-title class_">NumType</span>, <span class="hljs-attr">y</span>: <span class="hljs-title class_">NumType</span></span>) =&gt;</span> <span class="hljs-title class_">NumType</span><br>&#125;<br><span class="hljs-keyword">const</span> myNum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">number</span>&gt;()<br><br><span class="hljs-comment">// 泛型工具类型（Partial）</span><br><span class="hljs-comment">/*构造出来的新类型PartialProps结构和Props相同，但所有属性都变为是可选的*/</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">children</span>: <span class="hljs-built_in">number</span>[]<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialProps</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Props</span>&gt;<br><br><span class="hljs-comment">// 泛型工具类型（Readonly）</span><br><span class="hljs-comment">/*构造一个所有属性为只读的类型*/</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">children</span>: <span class="hljs-built_in">number</span>[]<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyProps</span> = <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Props</span>&gt;<br><br><span class="hljs-comment">// 泛型工具类型（Pick）</span><br><span class="hljs-comment">/*Pick&lt;Type,Keys&gt;从Type中选择一组属性来构造新类型*/</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span><br>    <span class="hljs-attr">children</span>: <span class="hljs-built_in">number</span>[]<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PickProps</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">Props</span>, <span class="hljs-string">&#x27;id&#x27;</span> | <span class="hljs-string">&#x27;title&#x27;</span>&gt;<br><br><span class="hljs-comment">// 泛型工具类型（Record）</span><br><span class="hljs-comment">/*Record&lt;Keys,Type&gt;构造一个新对象类型，属性键为Keys，属性类型为Type*/</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">RecordObj</span> = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span> | <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-built_in">string</span>[]&gt;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">RecordObj</span> = &#123;<br>    <span class="hljs-attr">a</span>: [<span class="hljs-string">&#x27;1&#x27;</span>],<br>    <span class="hljs-attr">b</span>: [<span class="hljs-string">&#x27;2&#x27;</span>],<br>    <span class="hljs-attr">c</span>: [<span class="hljs-string">&#x27;3&#x27;</span>]<br>&#125;<br><br><span class="hljs-comment">// 索引签名类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AnyObject</span> &#123;<br>    [<span class="hljs-attr">key</span>: steing]: <span class="hljs-built_in">number</span><br>&#125;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">AnyObject</span> = &#123;<br>    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">b</span>: <span class="hljs-number">2</span><br>&#125;<br> <br><span class="hljs-comment">// 映射类型</span><br><span class="hljs-comment">/*基于旧类型创建新类型，只能在类型别名中使用*/</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PropKeys</span> = <span class="hljs-string">&#x27;x&#x27;</span> | <span class="hljs-string">&#x27;y&#x27;</span> | <span class="hljs-string">&#x27;z&#x27;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Type</span> = &#123; [<span class="hljs-title class_">Key</span> <span class="hljs-keyword">in</span> <span class="hljs-title class_">PropKeys</span>]: <span class="hljs-built_in">number</span> &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = &#123; <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">c</span>: <span class="hljs-built_in">boolean</span> &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Type</span> = &#123; [<span class="hljs-title class_">Key</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Props</span>]: <span class="hljs-built_in">number</span> &#125;<br><br><span class="hljs-comment">// 索引查询类型</span><br><span class="hljs-comment">/*T[P]语法用来查询属性的类型*/</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = &#123; <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">c</span>: <span class="hljs-built_in">boolean</span> &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeA</span> = <span class="hljs-title class_">Props</span>[<span class="hljs-string">&#x27;a&#x27;</span>]<span class="hljs-comment">//number</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeA</span> = <span class="hljs-title class_">Props</span>[<span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span>]<span class="hljs-comment">//number|string</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeA</span> = <span class="hljs-title class_">Props</span>[keyof <span class="hljs-title class_">Props</span>]<span class="hljs-comment">//number|string|boolean</span><br></code></pre></td></tr></table></figure><p><strong>TS中的文件类型</strong></p><p>.ts文件</p><ul><li>既包含类型信息又可执行代码</li><li>可以被编译为.js文件然后执行</li><li>用途：编写程序代码的地方</li></ul><p>.d.ts文件（类似于C++中的头文件）</p><ul><li><p>只包含类型信息的类型声明文件</p></li><li><p>不会生成.js文件，仅用于提供类型信息</p></li><li><p>用途：为js提供类型信息</p></li><li><pre><code class="tsx">//为js文件提供类型声明/*在js文件中已存在如下的内容let count = 10let songName = &#39;痴心绝对&#39;let position = &#123;x: 0,y: 0&#125;function add(x,y) &#123;retrun x+y&#125;function changeDirection(direction)&#123;console.log(direction)&#125;const fomartPoint = point =&gt; &#123;console.log(&#39;当前坐标:&#39;, point)&#125;export &#123;count, songName, position, add, changeDirection&#125;*/declare let count: numberdeclare let someName: stringinterface Point &#123;    x: number    y: number&#125;declare let positon: Pointdeclare function add(x: mumber, y: number): numberdeclare function changeDirection(direction: &#39;up&#39;|&#39;down&#39;|&#39;left&#39;|&#39;right&#39;):voidtype FomartPoint = (point: Point) =&gt; voiddeclare const fomartPoint: FomartPoint// declare const fomartPoint: (point: Point) =&gt; voidexport &#123;count, songName, position, add, changeDirection&#125;</code></pre></li></ul><h1 id="SSM"><a href="#SSM" class="headerlink" title="SSM"></a>SSM</h1><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><p><strong>1.Spring Framework系统架构</strong></p><ul><li><p><code>Core Container</code> : 核心容器</p><p><code>AOP</code> : 面向切面编程</p><p><code>Aspects</code> : AOP思想实现</p><p><code>Data  Access</code> : 数据访问</p><p><code>Data Integration</code> : 数据集成</p><p><code>Web</code> : Web开发</p><p><code>Test</code> : 单元测试与集成测试</p></li><li><p><strong>IoC（Inversion of Control）控制反转</strong>：使用对象事，由主动new产生对象转换为由外部提供对象，此过程中对象创建控制权由程序转移到外部，此思想称为控制反转</p></li><li><p>Spring提供了一个容器，称为<strong>IoC容器</strong>，用来充当IoC思想中的“外部”</p><p>IoC容器负责对象的创建、初始化等一系列工作，被创建或被管理的对象在IoC容器中统称为<strong>Bean</strong></p></li><li><p><strong>DI（Dependency Injection）依赖注入</strong>：在容器中建立bean与bean之间的依赖关系的整个过程，称为依赖注入</p></li></ul><p><strong>2.bean</strong></p><ul><li><table><thead><tr><th align="left"><span style="display:inline-block;width:100px">类别</span></th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">名称</td><td align="left">bean</td></tr><tr><td align="left">类型</td><td align="left">标签</td></tr><tr><td align="left">所属</td><td align="left">beans标签</td></tr><tr><td align="left">格式</td><td align="left"><strong><beans><br />         <bean/><br />         <bean></bean><br /></beans></strong></td></tr><tr><td align="left">属性列表</td><td align="left">id：bean的id，使用容器可以通过id值获取对应的bean，在一个容器中id值唯一<br /><br />class：bean的类型，即配置的bean的全路径类名<br /><br />name：bean的别名，可以有多名称，空格分开<br /><br />scope：bean的作用范围，可以控制创建实例的数量，是否是单例的对象，可选范围【singleton（单例默认）、prototype（非单例）】<br /><br />init-method：bean初始化方法<br /><br />destroy-method：bean的销毁方法</td></tr><tr><td align="left">范例</td><td align="left"><bean id="bookDao" name="service dao" class="com.itheima.dao,impl.BookDaoImpl" scope="prototype" /></td></tr><tr><td align="left">实例化</td><td align="left">构造函数：<bean id="bookDao" class="com.itheima.dao,impl.BookDaoImpl" /><br /><br />使用静态工厂：<bean id="orderDao" class="com.itheima.factory.OrderDaoFactory" factory-method="getOrderDao" /><br /><br />使用实例工厂：<br /><bean id="userFactory" class="com.itheima,factory.UserDaoFactory"  /><br /><bean id="userDao" factory-method="getUserDao" factory-bean="userFactory" /><br /><br /></td></tr><tr><td align="left">生命周期</td><td align="left">阶段：<br />1、初始化容器：①创建对象（内存分配）②执行构造方法③执行属性注入（set操作）④执行bean初始化方法<br />2、使用bean：①执行业务操作<br />3、关闭&#x2F;销毁容器：①执行bean销毁方法<br /><br /><br />pbulic class BookDaoImpl implements BookDao {<br />     &#x2F;&#x2F; 表示bean初始化对应的操作<br />     public void init(){<br />          System.out.println(“init…”)<br />     }<br /><br />     &#x2F;&#x2F; 表示bean销毁前对应的操作<br />     <strong>【<br />        需要关闭容器：<br />        ①手工关闭容器：ConfigurableApplicationContext接口close()操作<br />        ②注册关闭钩子，在虚拟机退出前先关闭容器再退出虚拟机：ConfigurableApplicationContext接口registerShutdownHook()操作<br />        】<br /></strong> <br />     public void destory{<br />          System.out.println(“destory…”)<br />     }<br />}<br /><br /><br />&#x2F;&#x2F; 需要在配置文件中进行配置<br /><bean id="bookDao" class="com.itheima.dao,impl.BookDaoImpl" init-method="init" destory-method="destory" /><br /><br /><br />【也可以使用接口控制生命周期，InitializingBean，DisposableBean接口】</td></tr></tbody></table></li></ul><p><strong>3.依赖注入</strong></p><ul><li>setter注入<property name="" ref="" /></li><li>构造器注入<constructor-arg name="" ref="" /></li><li>自动装配：<bean id="bookService" class="com.itheima.service,impl.BookServiceImpl" autowire="byType" /><ul><li>方式：按类型（常用）、按名称、按构造方法、不启用自动装配</li></ul></li></ul><p><strong>4.集合注入</strong></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Express入门</title>
    <link href="/2024/02/22/express%E5%85%A5%E9%97%A8/"/>
    <url>/2024/02/22/express%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="express入门"><a href="#express入门" class="headerlink" title="express入门"></a>express入门</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>作为前端开发，Nodejs已经成了很多公司对我们这一岗位的硬性要求，而 Express 框架则是其中知名度最高、也是最受欢迎的Nodejs开发框架，它帮助我们封装了Nodejs底层的API，屏蔽了大量的繁琐的细节，让我们只需要关注业务开发就行了，极大的降低了学习的成本。今天这个课程就是教大家去掌握如何使用express去搭建一个简易的后端服务，我们主要围绕以下几个部分：</p><ul><li>路由</li><li>中间件</li><li>静态文件服务</li><li>模板引擎</li></ul><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li><p>电脑 - mac</p></li><li><p>Node - 16.14.2</p></li><li><p>Npm - 8.5.0</p></li><li><p>Express - 4.x</p></li></ul><h3 id="第一个demo"><a href="#第一个demo" class="headerlink" title="第一个demo"></a>第一个demo</h3><h5 id="使用Nodejs内置的http模块搭建服务"><a href="#使用Nodejs内置的http模块搭建服务" class="headerlink" title="使用Nodejs内置的http模块搭建服务"></a>使用Nodejs内置的http模块搭建服务</h5><p>为了便于大家去理解express对nodejs做了哪些封装，在使用express之前，我们先来看下使用nodejs内置的http模块是怎么搭建node服务的。</p><p>首先创建一个<code>express-demo</code>的文件夹并进入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> express-demo &amp;&amp; <span class="hljs-built_in">cd</span> express-demo<br></code></pre></td></tr></table></figure><p>创建<code>server.js</code>，并添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">200</span><br>  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/html&#x27;</span>)<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br>&#125;)<br><br>server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;服务已启动...&#x27;</span>);<br>&#125;)<br></code></pre></td></tr></table></figure><p>然后在控制台中运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">node server.js<br></code></pre></td></tr></table></figure><h5 id="使用express搭建服务"><a href="#使用express搭建服务" class="headerlink" title="使用express搭建服务"></a>使用express搭建服务</h5><p>接下来，我们再用express搭建服务。</p><p>在 <code>express-demo</code> 文件夹下执行 <code>npm init</code> 命令，然后一路回车，就会帮我们创建一个 <code>package.json</code> 文件，然后再执行 <code>npm install express </code>来安装express模块，然后改写 <code>server.js</code> 。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;服务已启动...&#x27;</span>);<br>&#125;)<br></code></pre></td></tr></table></figure><h5 id="Request和Response对象"><a href="#Request和Response对象" class="headerlink" title="Request和Response对象"></a>Request和Response对象</h5><ul><li><p>Request对象是请求对象，就是回调函数中的<code>req</code>参数，主要是网络请求中带的一些属性，比如参数, cookie等等。。。</p></li><li><p>Response对象是响应对象，就是回调函数中的<code>res</code>参数，可以执行一系列的响应操作，比如给客户端响应内容和状态等等。。。</p></li></ul><p>查看Request和Response对象的<a href="https://www.expressjs.com.cn/4x/api.html#req">所有API</a></p><h5 id="路由机制"><a href="#路由机制" class="headerlink" title="路由机制"></a>路由机制</h5><p>思考：我们在向后端发请求时通过什么去区分接口的？</p><p>答：请求方式+接口url</p><p>我们在express中，定义路由的方式是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">METHOD</span>(<span class="hljs-variable constant_">URL</span>, <span class="hljs-variable constant_">CALLBACK</span>)<br></code></pre></td></tr></table></figure><p>这种方式就可以通过请求方式和URL来帮我们区分不同的请求，从而去执行不同的响应。</p><h5 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h5><p>nodemon能够检测工作区代码的变化，并自动重启。</p><p>执行 <code>npm install nodemon --save-dev</code> 安装nodemon，然后修改package.json文件中的start命令：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;express-demo&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;server.js&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nodemon server.js&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ISC&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.18.2&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;nodemon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.0.20&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>再执行<code>npm start</code>启动服务，之后我们再修改代码就不需要手动的重启服务了。</p><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>在浏览器中我们想要访问百度，只需要知道百度的地址就行了，路由也是类似的概念，我们想要知道客户端调用的是哪个接口，就是通过路由来判断的。</p><h5 id="路由方法"><a href="#路由方法" class="headerlink" title="路由方法"></a>路由方法</h5><p>Express 支持对应于 HTTP 方法的以下路由方法：<code>get</code>、<code>post</code>、<code>put</code>、<code>delete</code>等等。使用方法为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">METHOD</span>(<span class="hljs-variable constant_">URL</span>, <span class="hljs-variable constant_">CALLBACK</span>)<br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;小明&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>有一种特殊路由方法：<code>app.all()</code>，该方法用于在所有请求方法的路径中装入中间件函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">all</span>(<span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jackie&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span><br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>这个示例中不管是<code>get</code>, <code>post</code>方式去请求<code>/about</code>路径的接口，都会经过这个回调函数然后返回对应的数据。</p><h5 id="路由路径"><a href="#路由路径" class="headerlink" title="路由路径"></a>路由路径</h5><p>路由路径可以是字符串、字符串模式或正则表达式。字符串类型的就是我们之前举的那些例子，我们再来看下字符串模式和正则表达式这两种。</p><p>以下是基于字符串模式的路由路径的一些示例。</p><p>此路由路径将匹配 <code>acd</code> 和 <code>abcd</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/ab?cd&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ab?cd&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>此路由路径将匹配 <code>abcd</code>、<code>abbcd</code>、<code>abbbcd</code> 等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/ab+cd&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ab+cd&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>此路由路径将匹配 <code>abcd</code>、<code>abxcd</code>、<code>abRABDOMcd</code>、<code>ab123cd</code> 等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/ab*cd&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ab*cd&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>基于正则表达式的路由路径的示例：</p><p>此路由路径将匹配名称中具有“a”的所有路由。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-regexp">/a/</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/a/&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>此路由路径将匹配 <code>butterfly</code> 和 <code>dragonfly</code>，但是不匹配 <code>butterflyman</code>、<code>dragonfly man</code> 等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-regexp">/.*fly$/</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/.*fly$/&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="路由拆分"><a href="#路由拆分" class="headerlink" title="路由拆分"></a>路由拆分</h5><p>当我们的路由越来越复杂，比如有用户相关的路径，有系统相关的路径，不统一管理的话会显得特别乱，这个时候，对路由进行拆分是个不错的选择。</p><ul><li><p>拆分前</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/list&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>)&#123;<br>res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/list&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/detail&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>)&#123;<br>res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/detail&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure></li><li><p>拆分后</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-keyword">const</span> user = express.<span class="hljs-title class_">Router</span>();<br><br>user.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/list&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>)&#123;<br>res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/list&#x27;</span>);<br>&#125;);<br><br>user.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/detail&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>)&#123;<br>res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/detail&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/user&#x27;</span>, user); <span class="hljs-comment">// 注册user子路由</span><br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure></li></ul><h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p>一般学习js的时候，我们都会听到一句话：一切皆函数。而在学习express的过程中，很深的一个感受就是：一切皆中间件。比如常见的请求参数解析、cookie解析、日志打印等，都可以通过中间件来完成。</p><p>在 Express 中，中间件就是一个函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">someMiddleware</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// 自定义逻辑</span><br>  <span class="hljs-title function_">next</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>三个参数中，<code>req</code> 和 <code>res</code> 就是前面提到的 Request 请求对象和 Response 响应对象；而 <code>next</code> 函数则用来触发下一个中间件的执行。</p><p>在 Express 使用中间件有两种方式：<strong>全局中间件</strong>和<strong>路由中间件</strong>。</p><h5 id="全局中间件"><a href="#全局中间件" class="headerlink" title="全局中间件"></a>全局中间件</h5><p>通过 <code>app.use</code> 函数就可以注册中间件，并且此中间件会在用户发起<strong>任何请求</strong>都可能会执行，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(someMiddleware)<br></code></pre></td></tr></table></figure><h5 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h5><p>通过在路由定义时注册中间件，此中间件只会在用户访问该路由时执行，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/middleware&#x27;</span>, someMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hello World&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="编写一个日志中间件"><a href="#编写一个日志中间件" class="headerlink" title="编写一个日志中间件"></a>编写一个日志中间件</h5><ol><li>新建一个logger.js，并写入以下函数</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-keyword">const</span> time = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">$&#123;time.toLocaleString()&#125;</span>] <span class="hljs-subst">$&#123;req.method&#125;</span> <span class="hljs-subst">$&#123;req.url&#125;</span>`</span>);<br>  <span class="hljs-title function_">next</span>();<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = logger;<br></code></pre></td></tr></table></figure><ol start="2"><li>在server.js引入logger函数并且全局注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./logger&#x27;</span>)<br>...<br>...<br>app.<span class="hljs-title function_">use</span>(logger)<br>...<br>...<br></code></pre></td></tr></table></figure><p>这样我们在访问路由后，每次都会在控制台打印一行日志，如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[2023/2/27 15:54:29]</span> GET /<br><span class="hljs-string">[2023/2/27 15:54:47]</span> POST /about<br></code></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：如果忘记在中间件中调用 <code>next</code> 函数，并且又不直接返回响应时，服务器会直接卡在这个中间件不会继续执行下去哦！</p></blockquote><h4 id="模版引擎"><a href="#模版引擎" class="headerlink" title="模版引擎"></a>模版引擎</h4><p>模版引擎可以简单的理解为升级版的<code>html</code>文档，express可以用模版引擎来渲染前端页面，模版引擎有很多种，包括<code>jade</code>, <code>ejs</code>, <code>nunjunks</code>, <code>Handlebars</code>等等，express对每一种都提供了很好的支持，只需要几行代码就可以使用。我们今天来学习下<code>Handlebars</code>。</p><p>首先，第一步是安装对应的模版引擎：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hbs<br></code></pre></td></tr></table></figure><p>然后创建views文件夹，并且新建一个index.hbs的文件，添加如下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>express入门课程<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>作为前端开发，Nodejs已经成了很多公司对我们这一岗位的硬性要求，而 Express 框架则是其中知名度最高、也是最受欢迎的Nodejs开发框架。。。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后再添加一个about.hbs的文件，并添加如下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>黑马前端<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>学前端，来黑马<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p>最后便是在 server.js 中配置和使用模板。配置模板的代码非常简单：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 指定模板存放目录</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;views&#x27;</span>);<br><br><span class="hljs-comment">// 指定模板引擎为 Handlebars</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;hbs&#x27;</span>);<br></code></pre></td></tr></table></figure><p>在使用模板时，只需在路由回调函数中调用 <code>res.render</code> 方法即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ...</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;views&#x27;</span>);<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;hbs&#x27;</span>);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 渲染index.hbs模版</span><br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 渲染about.hbs模版</span><br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;about&#x27;</span>);<br>&#125;)<br><br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure><p>当我们访问<code>localhost:3000</code>时就会加载对应的index.hbs这个模版，当我们访问<code>localhost:3000/about</code>时就会加载对应的about.hbs这个模版</p><p>我们还可以给模版引擎中传一些动态参数，这样就会渲染出来不同的内容，将about.hbs改成如下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>黑马前端<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>学前端，来黑马<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>讲师：&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：&#123;&#123; age &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后在渲染该模版时加上第二个参数:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 渲染about.hbs模版</span><br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;about&#x27;</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;jackie&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;);<br>&#125;)<br></code></pre></td></tr></table></figure><p>这样当渲染出来的时候就会根据我们传进去的参数动态渲染前端页面了</p><h4 id="静态文件服务"><a href="#静态文件服务" class="headerlink" title="静态文件服务"></a>静态文件服务</h4><p>客户端一般需要访问一些图片视频等静态资源文件，那么这些文件如何发送给客户端呢，就需要用到静态文件服务了，而 Express 已经自带了静态文件服务中间件 <code>express.static</code>，使用起来非常方便。</p><p>假设我们的静态资源在public下面：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">public<br>├── css<br>│   └── style<span class="hljs-selector-class">.css</span><br>└── <span class="hljs-selector-tag">img</span><br>    └── logo.png<br></code></pre></td></tr></table></figure><p>然后我们只需要在server.js中添加一行代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;public&#x27;</span>));<br></code></pre></td></tr></table></figure><p>然后我们就可以通过下面的路径访问到这些资源了：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/css/</span>style.css<br>http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/img/</span>logo.png<br></code></pre></td></tr></table></figure><p>在模板引擎中放入这些资源的引入，我们就可以模板中使用了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/css/style.css&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>express入门课程<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>作为前端开发，Nodejs已经成了很多公司对我们这一岗位的硬性要求，而 Express 框架则是其中知名度最高、也是最受欢迎的Nodejs开发框架。。。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><p>再次运行服务器，并访问我们的网站时，就发现样式加到了我们的前端页面上了。</p><h4 id="处理404和服务器错误"><a href="#处理404和服务器错误" class="headerlink" title="处理404和服务器错误"></a>处理404和服务器错误</h4><p>我们在访问一些路由时有可能这个路由没有定义，这个时候就会返回404的状态码，或者有时候服务器内部代码出错了，就会返回500的错误码，这些情况是在开发中经常碰到的，那么服务端应该如何处理这些异常的情况呢？</p><ul><li><p>对于 404，只需在所有路由之后再加一个中间件，用来接收所有路由均匹配失败的请求</p></li><li><p>对于错误处理，前面所有中间件抛出异常时都会进入错误处理函数，可以使用 Express 自带的，也可以自定义。</p></li></ul><h5 id="处理404"><a href="#处理404" class="headerlink" title="处理404"></a>处理404</h5><p>只需在server.js中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;404&#x27;</span>, &#123; <span class="hljs-attr">url</span>: req.<span class="hljs-property">originalUrl</span> &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>然后在views下面新建一个404.hbs的模版文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>找不到你要的页面了！<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>你所访问的路径 &#123;&#123; url &#125;&#125; 不存在<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>*</code> 表示匹配任何路径。将此中间件放在所有路由后面，即可捕获所有访问路径均匹配失败的请求，然后渲染404的那个模版引擎就可以了。</p><p><strong>注意</strong>：一定是放在所有路由的后面，只有前面的路由都匹配不上才会匹配到<code>*</code>的这个路由</p><h5 id="处理内部错误"><a href="#处理内部错误" class="headerlink" title="处理内部错误"></a>处理内部错误</h5><p>在server.js中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;500&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>然后在views下面新建一个500.hbs的模版文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>服务器好像开小差了<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>过一会儿再试试看吧！See your later~<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>注意</strong>：在server.js中添加的代码也必须要添加到所有路由的后面，不然不能处理全部的错误</p><p>我们在某个路由中手动抛出一个错误后，客户端就会渲染500.hbs这个模版文件。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>至此express基础内容就讲解完了，这些都是express的核心知识点，后续还会有express的进阶课程，到时候会涉及到用express操作数据库和实战的内容，感兴趣的话可以关注我们的b站动态，及时跟进课程。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>寒假学习</title>
    <link href="/2024/01/12/%E5%AF%92%E5%81%87%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/01/12/%E5%AF%92%E5%81%87%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="第一周"><a href="#第一周" class="headerlink" title="第一周"></a>第一周</h1><h2 id="Vue2"><a href="#Vue2" class="headerlink" title="Vue2"></a>Vue2</h2><h3 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h3><ol><li>查询参数传参（更适合多个参数）：?参数&#x3D;参数值 &#x3D;&gt; this.$route.query.参数名</li><li>动态路由传参（更适合单个参数）：&#x2F;路径&#x2F;参数 &#x3D;&gt; this.$route.params.参数名</li></ol><h3 id="组件缓存keep-alive"><a href="#组件缓存keep-alive" class="headerlink" title="组件缓存keep-alive"></a>组件缓存keep-alive</h3><p>将缓存所有切换的组件</p><p>三个属性：include——<strong>组件名</strong>数组，只有匹配的组件会被缓存</p><p>​ exclude——<strong>组件名</strong>数组，任何匹配的组件都不会被缓存</p><p>​ max——最多可以缓存多少组件实例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>        &lt;keep-alive :include=&quot;[&#x27;LayoutPage&#x27;]&quot;&gt;<br>        &lt;router-view&gt;&lt;/router-view&gt;<br>        &lt;/keep-alive&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>组件缓存了之后就不会再执行created、mounted、destroyed等钩子</p><p>提供了两个声明周期函数：activated(){} deactivated(){}</p><h3 id="利用VueX创建仓库"><a href="#利用VueX创建仓库" class="headerlink" title="利用VueX创建仓库"></a>利用VueX创建仓库</h3><p><img src="https://eastynoss.oss-cn-chengdu.aliyuncs.com/202401301833577.png" alt="image-20240112213135637"></p><p>利用mutations修改数据，this.$store.comit(‘方法名’)</p><p>mapState映射到计算属性mapMutations映射到方法</p><p>mapActons映射到方法 mapGetters映射到计算属性</p><h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>处理异步，setTimeout模拟发请求</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">actions:&#123;<br>setAsynCount(context,num)&#123;<br>setTimeout(()=&gt;&#123;<br>context.comit(&#x27;changeCount&#x27;,num)<br>&#125;,1000)<br>&#125;<br>&#125;<br><br>this.$store.dispatch(&#x27;setAsyncCount&#x27;,200)<br></code></pre></td></tr></table></figure><h3 id="modules模块"><a href="#modules模块" class="headerlink" title="modules模块"></a>modules模块</h3><p>拆分子仓，便于维护</p><p>在子模块中写namespaced: true可以直接利用mapState映射其中的内容 </p><p>$store.getters[‘模块名&#x2F;xxx’] </p><h3 id="请求拦截器"><a href="#请求拦截器" class="headerlink" title="请求拦截器"></a>请求拦截器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs vue">/* 封装axios用于发送请求 */<br>import axios from &#x27;axios&#x27;<br>import &#123; Toast &#125; from &#x27;vant&#x27;<br><br>// 创建一个新的axios实例<br>const request = axios.create(&#123;<br>  baseURL: &#x27;http://cba.itlike.com/public/index.php?s=/api/&#x27;,<br>  timeout: 5000<br>&#125;)<br><br>// 添加请求拦截器<br>request.interceptors.request.use(function (config) &#123;<br>  // 在发送请求之前做些什么<br>  return config<br>&#125;, function (error) &#123;<br>  // 对请求错误做些什么<br>  return Promise.reject(error)<br>&#125;)<br><br>// 添加响应拦截器<br>request.interceptors.response.use(function (response) &#123;<br>  // 对响应数据做点什么<br>  const res = response.data<br>  console.log(res)<br>  if (res.status !== 200) &#123;<br>    // 给提示<br>    Toast(res.message)<br>    // 抛错误promise<br>    return Promise.reject(res.message)<br>  &#125;<br>  return res<br>&#125;, function (error) &#123;<br>  // 对响应错误做点什么<br>  return Promise.reject(error)<br>&#125;)<br><br>export default request<br></code></pre></td></tr></table></figure><h3 id="storage存储模块"><a href="#storage存储模块" class="headerlink" title="storage存储模块"></a>storage存储模块</h3><p>防止vuex刷新丢失，同时避免每次存取操作太长太麻烦的问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 约定一个通用的键名<br>const INFO_KEY = &#x27;hm_shopping_info&#x27;<br><br>// 获取个人信息<br>export const getInfo = () =&gt; &#123;<br>  const defaultObj = &#123; token: &#x27;&#x27;, userId: &#x27;&#x27; &#125;<br>  const result = localStorage.getItem(INFO_KEY)<br>  return result ? JSON.parse(result) : defaultObj<br>&#125;<br><br>// 设置个人信息<br>export const setInfo = (obj) =&gt; &#123;<br>  localStorage.setItem(INFO_KEY, JSON.stringify(obj))<br>&#125;<br><br>// 移除个人信息<br>export const removeInfo = () =&gt; &#123;<br>  localStorage.removeItem(INFO_KEY)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="登录节流操作"><a href="#登录节流操作" class="headerlink" title="登录节流操作"></a>登录节流操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 开启loading，禁止背景点击（节流处理，防止多次无效触发）<br>Toast.loading(&#123;<br>  message: &#x27;加载中...&#x27;,<br>  forbidClick: true, // 禁止背景点击<br>  loadingType: &#x27;spinner&#x27;, // 配置图标<br>  duration: 0 // 不会自动消失，响应拦截器回来之后关闭<br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">if (res.status !== 200) &#123;<br>  // 给提示<br>  Toast(res.message)<br>  // 抛错误promise<br>  return Promise.reject(res.message)<br>&#125; else &#123;<br>  // 正确清除loading效果<br>  Toast.clear()<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="页面访问拦截"><a href="#页面访问拦截" class="headerlink" title="页面访问拦截"></a>页面访问拦截</h3><p>设置全局前置路由</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">router.beforeEach(to,from,next)=&gt;&#123;<br>// to 往哪里去;from 从哪里来;next()是否放行,如果next()调用则放行,next(路径)拦截到某个路径页面<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="本周总结"><a href="#本周总结" class="headerlink" title="本周总结"></a>本周总结</h1><p>一直在跟着用vue2实现完整的商城项目，另外空余时间逐步在过渡vue3的基础知识，最近几天在搞三创赛需要用到的网页设计</p><h1 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h1><h2 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">创建：<span class="hljs-built_in">npm</span> init vue@latest<br></code></pre></td></tr></table></figure><p>setup允许在script中直接编写组合是API，setup()钩子执行时期早于beforeCreate()钩子，并且不再能使用this，数据和函数需要再setup最后return，<script setup></script>语法糖写法省略了return</p><p>template不再要求唯一根元素 </p><h3 id="reactive-和ref"><a href="#reactive-和ref" class="headerlink" title="reactive()和ref()"></a>reactive()和ref()</h3><p>reactive()作用：接受对象类型数据的参数传入并返回一个响应式的对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; reactive &#125; from &#x27;vue&#x27;<br>const state = reactive(&#123;<br>count:100<br>&#125;)<br>const setCount = () =&gt; &#123;<br>state.count++<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>&lt;div&gt;&#123;&#123; state.count &#125;&#125;&lt;/div&gt;<br>&lt;button @click=&quot;setCount&quot;&gt;+1&lt;/button&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>ref()作用：接收简单类型或对象类型的数据传入并返回一个响应式的对象</p><p>​  本质：是在原有传入数据的基础上，外层包了一层对象</p><p>​  在脚本中访问数据需要通过.value，在template中不需要加.value</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>const count = ref(0)<br>const setCount = () =&gt; &#123;<br>count.value++<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>&lt;div&gt;&#123;&#123; state.count &#125;&#125;&lt;/div&gt;<br>&lt;button @click=&quot;setCount&quot;&gt;+1&lt;/button&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="组合式API-computed"><a href="#组合式API-computed" class="headerlink" title="组合式API-computed"></a>组合式API-computed</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref,computed &#125; from &#x27;vue&#x27;<br>const list = ref([1,2,3,4,5,6,7,8])<br><br>const computedList = computed(()=&#123;<br>    return list.value.filter(item =&gt; item &gt; 2)<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>&lt;div&gt;原始数据：&#123;&#123; list &#125;&#125;&lt;/div&gt;<br>&lt;div&gt;计算后数据:&#123;&#123; computedList &#125;&#125;&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="组合式API-watch"><a href="#组合式API-watch" class="headerlink" title="组合式API-watch"></a>组合式API-watch</h3><p>作用：侦听一个或多个数据的变化，数据变化时执行回调函数</p><p>两个额外参数：immediate（立即执行）；deep（深度监听）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref,watch &#125; from &#x27;vue&#x27;<br>const count = ref(0)<br>const nickname = ref(&#x27;张三&#x27;)<br><br>const changeCount = ()=&gt;&#123;<br>    count.value++<br>&#125;<br>const cangeNickname = ()=&gt;&#123;<br>    nickname.value = &#x27;李四&#x27;<br>&#125;<br><br>// 监视单个<br>watch(count,(newValue,oldValue)=&gt;&#123;<br>    console.log(newValue,oldValue)<br>&#125;)<br>    <br>// 监视多个<br>watch([count,nickname],(newValue,oldValue)=&gt;&#123;<br>    console.log(newValue,oldValue)<br>&#125;)<br>    <br>// 立即执行<br>watch(count,(newValue,oldValue)=&gt;&#123;<br>    console.log(newValue,oldValue)<br>&#125;,&#123;<br>    immediate:true<br>&#125;)<br>    <br>// 深度监视[ref(简单类型)可以监听,ref(复杂类型)必须深度监听]<br>const userInfo = ref(&#123;<br>    name:&#x27;zs&#x27;,<br>    age:18<br>&#125;)<br>const setUserInfo = ()=&gt;&#123;<br>    userInfo.value.age++<br>&#125;<br>watch(userInfo,(newValue,oldValue)=&gt;&#123;<br>    console.log(newValue,oldValue)<br>&#125;,&#123;<br>    deep:true<br>&#125;)<br>  <br>// 对于对象中的属性进行监视<br>const userInfo = ref(&#123;<br>    name:&#x27;zs&#x27;,<br>    age:18<br>&#125;)<br>const setUserInfo = ()=&gt;&#123;<br>    userInfo.value.age++<br>&#125;<br>watch(() =&gt; userInfo.value.age,(newValue,oldValue) =&gt; &#123;<br>    console.log(newValue,oldValue)<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>        &#123;&#123; count &#125;&#125;<br>    &lt;/div&gt;<br>&lt;button @click=&quot;changeCount&quot;&gt;<br>        改数字<br>    &lt;/button&gt;<br>&lt;div&gt;<br>    &#123;&#123; nickname &#125;&#125;<br>    &lt;/div&gt;<br>&lt;button @click=&quot;changeNickname&quot;&gt;<br>        改昵称<br>    &lt;/button&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="组合式API-生命周期函数"><a href="#组合式API-生命周期函数" class="headerlink" title="组合式API-生命周期函数"></a>组合式API-生命周期函数</h3><table><thead><tr><th align="center">选项式API</th><th align="center">组合式API</th></tr></thead><tbody><tr><td align="center">beforeCreate&#x2F;created</td><td align="center">setup</td></tr><tr><td align="center">beforeMount</td><td align="center">onBeforeMount</td></tr><tr><td align="center">mounted</td><td align="center">onMounted</td></tr><tr><td align="center">beforeUpdate</td><td align="center">onBreforeUpdate</td></tr><tr><td align="center">updated</td><td align="center">onUpdated</td></tr><tr><td align="center">beforeUnmount</td><td align="center">onBeforeUnmount</td></tr><tr><td align="center">unmounted</td><td align="center">onUnmounted</td></tr></tbody></table><h3 id="组合式API-父子通信"><a href="#组合式API-父子通信" class="headerlink" title="组合式API-父子通信"></a>组合式API-父子通信</h3><p><strong>父传子</strong>：父组件给子组件绑定属性，子组件内部通过props选项接收，通过defineProps“编译器宏”接收子组件传递的数据</p><p><img src="https://eastynoss.oss-cn-chengdu.aliyuncs.com/202401282337703.png" alt="image-20240128233723469"></p><p><strong>子传父</strong>：父组件中组件标签通过@绑定事件，子组件内部通过emit方法触发事件，通过defineEmits编译器宏生成emit方法</p><p><img src="https://eastynoss.oss-cn-chengdu.aliyuncs.com/202401291346681.png" alt="image-20240129134637403"></p><h3 id="组合式API-模板引用"><a href="#组合式API-模板引用" class="headerlink" title="组合式API-模板引用"></a>组合式API-模板引用</h3><p>调用ref函数生成一个ref对象，通过ref标识绑定ref对象到标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;scipt setup&gt;<br>    import TestCom from &quot;@/components/........&quot;<br>    import &#123; ref, onMounted &#125; from &#x27;vue&#x27;<br>    <br>    const inp = ref(null)<br>    <br>    // 生命钩子onMounted等dom渲染完<br>    onMounted(()=&gt;&#123;<br>    // console.log(inp.value)<br>    // inp.value.focus()<br>    &#125;)<br>    <br>    const clickFn = ()=&gt;&#123;<br>    inp.value.focus()<br>    &#125;<br>&lt;/scipt&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>        &lt;input ref=&quot;inp&quot; type=&quot;text&quot;&gt;<br>        &lt;button @click=&quot;clickFn&quot;&gt;<br>            点击让输入框聚焦<br>    &lt;/button&gt;<br>    &lt;/div&gt;<br>&lt;TestCom/&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>默认情况下在<script setup>语法糖下组件内部的属性和方法是不开放给父组件访问的,可以通过defineExpose编译宏指定哪些属性和方法允许访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>    const testMessage = ref(&#x27;this is test message&#x27;)<br>    defineExpose(&#123;<br>        testMessage<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="组合式API-provide和inject"><a href="#组合式API-provide和inject" class="headerlink" title="组合式API-provide和inject"></a>组合式API-provide和inject</h3><p>顶层组件向任意的底层组件传递数据和方法，实现跨层组件通信</p><ul><li><p>普通数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 顶层组件<br>provide(&#x27;key&#x27;,顶层组件中的数据)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 底层组件<br>const message = inject(&#x27;key&#x27;)<br></code></pre></td></tr></table></figure></li><li><p>响应式数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 顶层组件<br>provide(&#x27;app-key&#x27;,ref对象)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 底层组件<br>const message = inject(&#x27;app-key&#x27;)<br></code></pre></td></tr></table></figure></li><li><p>方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 顶层组件<br>const setCount = () =&gt; &#123;<br>count,value++<br>&#125;<br>provide(&#x27;setCount-key&#x27;,setCount)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">// 底层组件<br>const setCount = inject(&#x27;setCount-key&#x27;)<br></code></pre></td></tr></table></figure></li></ul><h3 id="defineOptions"><a href="#defineOptions" class="headerlink" title="defineOptions"></a>defineOptions</h3><p>用defineOptions定义任意的选项，props、emits、expose、slots除外</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>defineOptions(&#123;<br>        name:&#x27;&#x27;,<br>        inheritAttrs:false,<br>        .........<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h3><p>Vuex的替代品</p><p>手动添加pinia</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">import &#123; createApp &#125; from &#x27;vue&#x27;<br>import &#123; createPinia &#125; from &#x27;pinia&#x27;<br>import App from &#x27;./App.vue&#x27;<br><br>const pinia = createPinia()<br>const app = createApp(App)<br><br>app.use(pinia)<br>app.use(&#x27;#app&#x27;)<br></code></pre></td></tr></table></figure><ul><li><p>基础使用：定义store，组件使用store</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">import &#123; defineStore &#125; from &#x27;pinia&#x27;<br>import &#123; ref,computed &#125; from &#x27;vue&#x27;<br><br>// 定义store<br>// defineStore(仓库的唯一标识),() =&gt; &#123;....&#125;)<br><br>export const useCOunterStore = defineStore(&#x27;counter&#x27;,() =&gt; &#123;<br>// 声明数据 state<br>const count = ref(0)<br><br>// 声明操作数据的方法 actions （普通函数）<br>const addCount = () =&gt; count.value++<br><br>// 声明基于数据派生的计算属性 getters （computed）<br>const double = computed(() =&gt; count.value * 2)<br><br>return &#123;<br>count,<br>double,<br>addCount<br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; useCounterStore &#125; from &#x27;@/store/....&#x27;<br>    const counterStore = useCounterStore()<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;div&gt;<br>        我是Son1.vue - &#123;&#123; counterStore.count &#125;&#125; - &#123;&#123; counterStore.double &#125;&#125;<br>        &lt;button @click=&quot;counterStore.addCount&quot;&gt;+&lt;/button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure></li></ul><p><code>stpreTpRefs</code> - 可以使pinia产生的store解构赋值数据保持响应式</p><p>Pinia持久化——白雪localStorage</p><ul><li><p>下载依赖，导入，使用</p><p><code>import persist from &#39;pinia-plugun-persistedstate&#39;</code> - 导入持久化插件</p><p><code>app.use(pinia.use(persist))</code> - piania插件的安装配置</p><p><code>persist:true</code> - 在组合式的第三个参数中添加开启当前模块的持久化（默认是整个state被持久化到localStorage）</p></li></ul><h3 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h3><p><img src="https://eastynoss.oss-cn-chengdu.aliyuncs.com/202401311616720.png" alt="image-20240131161640522"></p><h1 id="第三周"><a href="#第三周" class="headerlink" title="第三周"></a>第三周</h1><h2 id="el-row-el-col-el-form"><a href="#el-row-el-col-el-form" class="headerlink" title="el-row/el-col/el-form"></a>el-row/el-col/el-form</h2><p><code>el-row</code> 一行分为24份</p><p><code>el-col :span=&quot;12&quot;</code> 该列占12份</p><p><code>el-col :offset:&quot;3&quot;</code> 左外边距3份</p><p><code>el-form</code> 表单</p><p><code>el-form-item</code> 表单中的每一个元素</p><h2 id="表单校验规则"><a href="#表单校验规则" class="headerlink" title="表单校验规则"></a>表单校验规则</h2><ul><li>非空校验——required:truemessage消息提示trigger触发校验的时机 blur(失焦时)\change(改变时)</li><li>长度校验——min:xxmax:xx</li><li>正则校验——pattern:正则规则(例如: \^\S{6,15}$\ 表示6-25位的非空字符)</li><li>自定义校验——validator:(rule,value,callback)<ul><li>rule当前校验规则相关的信息</li><li>value所校验的表单元素目前的表单值</li><li>callback无论成功还是失败都需要callback<ul><li>callback()校验成功</li><li>callback(new Errir(错误信息))校验失败</li></ul></li></ul></li></ul><h1 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h1><h2 id="node的http模块搭建的后端服务"><a href="#node的http模块搭建的后端服务" class="headerlink" title="node的http模块搭建的后端服务"></a>node的http模块搭建的后端服务</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">200</span><br>    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>,<span class="hljs-string">&#x27;Content-Type&#x27;</span>,<span class="hljs-string">&#x27;text/html&#x27;</span>)<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;...&#x27;</span>)<br>&#125;)<br><br>server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>,<span class="hljs-title function_">functon</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;服务已启动&#x27;</span>)              <br>&#125;)<br></code></pre></td></tr></table></figure><p>运行：<code>node server.js</code></p><h2 id="express搭建后端服务"><a href="#express搭建后端服务" class="headerlink" title="express搭建后端服务"></a>express搭建后端服务</h2><p>安装：npm install express</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)&#123;<br>    <span class="hljs-comment">// 相应内容</span><br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;...&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>,<span class="hljs-title function_">functon</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;服务已启动&#x27;</span>)              <br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="在-Express-中，中间件就是一个函数："><a href="#在-Express-中，中间件就是一个函数：" class="headerlink" title="在 Express 中，中间件就是一个函数："></a>在 Express 中，中间件就是一个函数：</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">someMiddleware</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// 自定义逻辑</span><br>  <span class="hljs-title function_">next</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>三个参数中，<code>req</code> 和 <code>res</code> 就是前面提到的 Request 请求对象和 Response 响应对象；而 <code>next</code> 函数则用来触发下一个中间件的执行。</p><h3 id="全局中间件"><a href="#全局中间件" class="headerlink" title="全局中间件"></a>全局中间件</h3><p>通过 <code>app.use</code> 函数就可以注册中间件，并且此中间件会在用户发起<strong>任何请求</strong>都可能会执行，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(someMiddleware)<br></code></pre></td></tr></table></figure><h3 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h3><p>通过在路由定义时注册中间件，此中间件只会在用户访问该路由时执行，例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/middleware&#x27;</span>, someMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hello World&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="编写一个日志中间件"><a href="#编写一个日志中间件" class="headerlink" title="编写一个日志中间件"></a>编写一个日志中间件</h3><ol><li>新建一个logger.js，并写入以下函数</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-keyword">const</span> time = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">$&#123;time.toLocaleString()&#125;</span>] <span class="hljs-subst">$&#123;req.method&#125;</span> <span class="hljs-subst">$&#123;req.url&#125;</span>`</span>);<br>  <span class="hljs-title function_">next</span>();<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = logger;<br></code></pre></td></tr></table></figure><ol start="2"><li>在server.js引入logger函数并且全局注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./logger&#x27;</span>)<br>...<br>...<br>app.<span class="hljs-title function_">use</span>(logger)<br>...<br>...<br></code></pre></td></tr></table></figure><p>这样我们在访问路由后，每次都会在控制台打印一行日志，如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[2023/2/27 15:54:29]</span> GET /<br><span class="hljs-string">[2023/2/27 15:54:47]</span> POST /about<br></code></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：如果忘记在中间件中调用 <code>next</code> 函数，并且又不直接返回响应时，服务器会直接卡在这个中间件不会继续执行下去哦！</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
